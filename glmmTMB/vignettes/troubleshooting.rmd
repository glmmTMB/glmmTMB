---
title: "Troubleshooting with glmmTMB"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{troubleshooting}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r echo=FALSE}
library(glmmTMB)
```

This vignette covers common problems that occur while using `glmmTMB`. 
The contents will expand with experience.

#Warnings

##Non-Positive-Definite Hessian matrix
After your model is fit, you may see the same warning in the following example
```{r non-pos-def}
zinbm0 = glmmTMB(count~spp +(1|site), zi=~spp, Salamanders, family="nbinom2")
```
This often occurs when a model is overparameterized (i.e. the data does not contain information to estimate the parameters).
However, in the example above, the problem is that the model doesn't capture the main pattern in the data where zero observations do not depend on species as in `zi=~spp`; rather, they depend on another covariate that is missing from the model `minded`. 
Plotting the data against potential covariates should help to avoid fitting unreasonable models that don't converge.

In some cases, scaling predictor variables may help.

Models with non-positive definite Hessian matricies should be excluded from further consideration, in general.  

##nlminb(start = par, objective = fn, gradient = gr): NA/NaN function evaluation
This warning often occurs when the optimizer wanders into a region of parameter space that is invalid. 
It is not a problem as long as the optimizer has left that region of parameter space upon convergence, which is indicated by an absence of the model convergence warnings described above. 

##Cholmod warning 'matrix not positive definite'

#Errors

##nlminb(start = par, objective = fn, gradient = gr): gradient function must return a numeric
This error can occur when the data do not conform to the specified distribution. 



```{r echo=FALSE, eval=FALSE}
#FIXME
#What's going on with this model?
#cov.fixed is full of NaN
m1=glmmTMB(count~spp + mined + (1|site), zi=~spp + mined, Salamanders, family="genpois")
```

