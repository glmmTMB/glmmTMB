<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit Models with TMB — glmmTMB • glmmTMB</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit Models with TMB — glmmTMB"><meta property="og:description" content="Fit a generalized linear mixed model (GLMM) using Template Model Builder (TMB)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-standard navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">glmmTMB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.8-9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/glmmTMB.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/covstruct.html">Covariance structures with glmmTMB</a>
    </li>
    <li>
      <a href="../articles/hacking.html">Hacking glmmTMB</a>
    </li>
    <li>
      <a href="../articles/mcmc.html">Post-hoc MCMC with glmmTMB</a>
    </li>
    <li>
      <a href="../articles/miscEx.html">Miscellaneous examples</a>
    </li>
    <li>
      <a href="../articles/model_evaluation.html">Model evaluation</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel optimization using glmmTMB</a>
    </li>
    <li>
      <a href="../articles/priors.html">Priors in glmmTMB</a>
    </li>
    <li>
      <a href="../articles/sim.html">Simulate from a fitted glmmTMB model or a formula</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting with glmmTMB</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="../repos/index.html">
    <span class="fa fa-database fa-lg"></span>
     
    binary packages
  </a>
</li>
<li>
  <a href="https://github.com/glmmTMB/glmmTMB" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit Models with TMB</h1>
    <small class="dont-index">Source: <a href="https://github.com/glmmTMB/glmmTMB/blob/HEAD/R/glmmTMB.R" class="external-link"><code>R/glmmTMB.R</code></a></small>
    <div class="hidden name"><code>glmmTMB.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit a generalized linear mixed model (GLMM) using Template Model Builder (TMB).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">glmmTMB</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  ziformula <span class="op">=</span> <span class="op">~</span><span class="fl">0</span>,</span>
<span>  dispformula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  offset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">na.action</span>,</span>
<span>  se <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  doFit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="glmmTMBControl.html">glmmTMBControl</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  REML <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  map <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sparseX <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  priors <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>combined fixed and random effects formula, following lme4 syntax.</p></dd>


<dt>data</dt>
<dd><p>data frame (tibbles are OK) containing model variables. Not required, but strongly recommended; if <code>data</code> is not specified, downstream methods such as prediction with new data (<code>predict(fitted_model, newdata = ...)</code>) will fail. If it is necessary to call <code>glmmTMB</code> with model variables taken from the environment rather than from a data frame, specifying <code>data=NULL</code> will suppress the warning message.</p></dd>


<dt>family</dt>
<dd><p>a family function, a character string naming a family function, or the result of a call to a family function (variance/link function) information. See <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">family</a></code> for a generic discussion of families or <code><a href="nbinom2.html">family_glmmTMB</a></code> for details of <code>glmmTMB</code>-specific families.</p></dd>


<dt>ziformula</dt>
<dd><p>a <em>one-sided</em> (i.e., no response variable) formula for zero-inflation combining fixed and random effects: the default <code>~0</code> specifies no zero-inflation. Specifying <code>~.</code> sets the zero-inflation formula identical to the right-hand side of <code>formula</code> (i.e., the conditional effects formula); terms can also be added or subtracted. <strong>When using <code>~.</code> as the zero-inflation formula in models where the conditional effects formula contains an offset term, the offset term will automatically be dropped</strong>. The zero-inflation model uses a logit link.</p></dd>


<dt>dispformula</dt>
<dd><p>a <em>one-sided</em> formula for dispersion containing only fixed effects: the default <code>~1</code> specifies the standard dispersion given any family. The argument is ignored for families that do not have a dispersion parameter. For an explanation of the dispersion parameter for each family, see <code><a href="sigma.glmmTMB.html">sigma</a></code>. The dispersion model uses a log link. In Gaussian mixed models, <code>dispformula=~0</code> fixes the residual variance to be 0 (actually a small non-zero value), forcing variance into the random effects. The precise value can be controlled via <code>control=glmmTMBControl(zero_dispval=...)</code>; the default value is <code>sqrt(.Machine$double.eps)</code>.</p></dd>


<dt>weights</dt>
<dd><p>weights, as in <code>glm</code>. Not automatically scaled to have sum 1.</p></dd>


<dt>offset</dt>
<dd><p>offset for conditional model (only).</p></dd>


<dt>contrasts</dt>
<dd><p>an optional list, e.g., <code>list(fac1="contr.sum")</code>. See the <code>contrasts.arg</code> of <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix.default</a></code>.</p></dd>


<dt>na.action</dt>
<dd><p>a function that specifies how to handle observations
containing <code>NA</code>s.  The default action (<code>na.omit</code>,
inherited from the 'factory fresh' value of
<code>getOption("na.action")</code>) strips any observations with any
missing values in any variables. Using <code>na.action = na.exclude</code>
will similarly drop observations with missing values while fitting the model,
but will fill in <code>NA</code> values for the predicted and residual
values for cases that were excluded during the fitting process
because of missingness.</p></dd>


<dt>se</dt>
<dd><p>whether to return standard errors.</p></dd>


<dt>verbose</dt>
<dd><p>whether progress indication should be printed to the console.</p></dd>


<dt>doFit</dt>
<dd><p>whether to fit the full model, or (if FALSE) return the preprocessed data and parameter objects, without fitting the model.</p></dd>


<dt>control</dt>
<dd><p>control parameters, see <code><a href="glmmTMBControl.html">glmmTMBControl</a></code>.</p></dd>


<dt>REML</dt>
<dd><p>whether to use REML estimation rather than maximum likelihood.</p></dd>


<dt>start</dt>
<dd><p>starting values, expressed as a list with possible components <code>beta</code>, <code>betazi</code>, <code>betadisp</code> (fixed-effect parameters for conditional, zero-inflation, dispersion models); <code>b</code>, <code>bzi</code> (conditional modes for conditional and zero-inflation models); <code>theta</code>, <code>thetazi</code> (random-effect parameters, on the standard deviation/Cholesky scale, for conditional and z-i models); <code>psi</code> (extra family parameters, e.g., shape for Tweedie models).</p></dd>


<dt>map</dt>
<dd><p>a list specifying which parameter values should be fixed to a constant value rather than estimated. <code>map</code> should be a named list containing factors corresponding to a subset of the internal parameter names (see <code>start</code> parameter). Distinct factor values are fitted as separate parameter values, <code>NA</code> values are held fixed: e.g., <code>map=list(beta=factor(c(1,2,3,NA)))</code> would fit the first three fixed-effect parameters of the conditional model and fix the fourth parameter to its starting value. In general, users will probably want to use <code>start</code> to specify non-default starting values for fixed parameters. See <code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">MakeADFun</a></code> for more details.</p></dd>


<dt>sparseX</dt>
<dd><p>a named logical vector containing (possibly) elements named "cond", "zi", "disp" to indicate whether fixed-effect model matrices for particular model components should be generated as sparse matrices, e.g. <code>c(cond=TRUE)</code>. Default is all <code>FALSE</code></p></dd>


<dt>priors</dt>
<dd><p>a data frame of priors, in a similar format to that accepted by the <code>brms</code> package; see <code><a href="priors.html">priors</a></code></p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    
<ul><li><p>Binomial models with more than one trial (i.e., not binary/Bernoulli) can either be specified in the form <code>prob ~ ..., weights = N</code>, or in the more typical two-column matrix <code>cbind(successes,failures)~...</code> form.</p></li>
<li><p>Behavior of <code>REML=TRUE</code> for Gaussian responses matches <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer</a></code>. It may also be useful in some cases with non-Gaussian responses (Millar 2011). Simulations should be done first to verify.</p></li>
<li><p>Because the <code><a href="https://rdrr.io/r/stats/df.residual.html" class="external-link">df.residual</a></code> method for <code>glmmTMB</code> currently counts the dispersion parameter, users should multiply this value by <code>sqrt(nobs(fit) / (1+df.residual(fit)))</code> when comparing with <code>lm</code>.</p></li>
<li><p>Although models can be fitted without specifying a <code>data</code> argument, its use is strongly recommended; drawing model components from the global environment, or using <code>df$var</code> notation within model formulae, can lead to confusing (and sometimes hard-to-detect) errors.</p></li>
<li><p>By default, vector-valued random effects are fitted with unstructured (general symmetric positive definite) variance-covariance matrices. Structured variance-covariance matrices can be specified in the form <code>struc(terms|group)</code>, where <code>struc</code> is one of</p><ul><li><p><code>diag</code> (diagonal, heterogeneous variance)</p></li>
<li><p><code>ar1</code> (autoregressive order-1, homogeneous variance)</p></li>
<li><p><code>cs</code> (compound symmetric, heterogeneous variance)</p></li>
<li><p><code>ou</code> (* Ornstein-Uhlenbeck, homogeneous variance)</p></li>
<li><p><code>exp</code> (* exponential autocorrelation)</p></li>
<li><p><code>gau</code> (* Gaussian autocorrelation)</p></li>
<li><p><code>mat</code> (* Matérn process correlation)</p></li>
<li><p><code>toep</code> (* Toeplitz)</p></li>
<li><p><code>rr</code> (reduced rank/factor-analytic model)</p></li>
<li><p><code>homdiag</code> (diagonal, homogeneous variance)</p></li>
</ul><p>Structures marked with * are experimental/untested. See <code><a href="../articles/covstruct.html">vignette("covstruct", package = "glmmTMB")</a></code> for more information.</p></li>
<li><p>For backward compatibility, the <code>family</code> argument can also be specified as a list comprising the name of the distribution and the link function (e.g. <code>list(family="binomial", link="logit")</code>). However, <strong>this alternative is now deprecated</strong>; it produces a warning and will be removed at some point in the future. Furthermore, certain capabilities such as Pearson residuals or predictions on the data scale will only be possible if components such as <code>variance</code> and <code>linkfun</code> are present, see <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">family</a></code>.</p></li>
<li><p>Smooths taken from the <code>mgcv</code> package can be included in <code>glmmTMB</code> formulas using <code>s</code>; these terms will appear as additional components in both the fixed and the random-effects terms. This functionality is <em>experimental</em> for now. We recommend using <code>REML=TRUE</code>. See <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></code> for details of specifying smooths (and <code><a href="https://rdrr.io/pkg/mgcv/man/smooth2random.html" class="external-link">smooth2random</a></code> and the appendix of Wood (2004) for technical details).</p></li>
</ul></div>
    <div id="note">
    <h2>Note</h2>
    <p>For more information about the <span class="pkg">glmmTMB</span> package, see Brooks et al. (2017) and the <code>vignette(package="glmmTMB")</code> collection. For the underlying <span class="pkg">TMB</span> package that performs the model estimation, see Kristensen et al. (2016).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Brooks, M. E., Kristensen, K., van Benthem, K. J., Magnusson, A., Berg, C. W., Nielsen, A., Skaug, H. J., Mächler, M. and Bolker, B. M. (2017). glmmTMB balances speed and flexibility among packages for zero-inflated generalized linear mixed modeling. <em>The R Journal</em>, <b>9</b>(2), 378--400.</p>
<p>Kristensen, K., Nielsen, A., Berg, C. W., Skaug, H. and Bell, B. (2016). TMB: Automatic differentiation and Laplace approximation. <em>Journal of Statistical Software</em>, <b>70</b>, 1--21.</p>
<p>Millar, R. B. (2011). <em>Maximum Likelihood Estimation and Inference: With Examples in R, SAS and ADMB.</em> Wiley, New York.
Wood, S. N. (2004) Stable and Efficient Multiple Smoothing Parameter Estimation for Generalized Additive Models. <em>Journal of the American Statistical Association</em> <b>99</b>(467): 673–86. <a href="https://doi.org/10.1198/016214504000000980" class="external-link">doi:10.1198/016214504000000980</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">glmmTMB</span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">mined</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">site</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  zi<span class="op">=</span><span class="op">~</span><span class="va">mined</span>,</span></span>
<span class="r-in"><span>  family<span class="op">=</span><span class="va">poisson</span>, data<span class="op">=</span><span class="va">Salamanders</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula:          count ~ mined + (1 | site)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Zero inflation:         ~mined</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: Salamanders</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       AIC       BIC    logLik  df.resid </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1908.4695 1930.8080 -949.2348       639 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random-effects (co)variances:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups Name        Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  site   (Intercept) 0.28    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs: 644 / Conditional model: site, 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed Effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)      minedno  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      0.0879       1.1419  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Zero-inflation model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)      minedno  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       1.139       -1.736  </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Family: poisson  ( log )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula:          count ~ mined + (1 | site)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Zero inflation:         ~mined</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: Salamanders</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      AIC      BIC   logLik deviance df.resid </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1908.5   1930.8   -949.2   1898.5      639 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups Name        Variance Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  site   (Intercept) 0.07843  0.28    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs: 644, groups:  site, 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   0.0879     0.2329   0.377    0.706    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> minedno       1.1419     0.2462   4.639  3.5e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Zero-inflation model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   1.1393     0.2351   4.846 1.26e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> minedno      -1.7361     0.2620  -6.626 3.44e-11 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-in"><span><span class="co">##' ## Zero-inflated negative binomial model</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu">glmmTMB</span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">spp</span> <span class="op">+</span> <span class="va">mined</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">site</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  zi<span class="op">=</span><span class="op">~</span><span class="va">spp</span> <span class="op">+</span> <span class="va">mined</span>,</span></span>
<span class="r-in"><span>  family<span class="op">=</span><span class="va">nbinom2</span>, data<span class="op">=</span><span class="va">Salamanders</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula:          count ~ spp + mined + (1 | site)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Zero inflation:         ~spp + mined</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: Salamanders</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       AIC       BIC    logLik  df.resid </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1670.2990 1750.7176 -817.1495       626 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random-effects (co)variances:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups Name        Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  site   (Intercept) 0.3799  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs: 644 / Conditional model: site, 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dispersion parameter for nbinom2 family (): 1.51 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed Effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)        sppPR        sppDM      sppEC-A      sppEC-L     sppDES-L  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -0.6104      -0.9637       0.1707      -0.3871       0.4879       0.5895  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sppDF      minedno  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -0.1133       1.4294  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Zero-inflation model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)        sppPR        sppDM      sppEC-A      sppEC-L     sppDES-L  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      0.9100       1.1614      -0.9393       1.0424      -0.5623      -0.8930  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sppDF      minedno  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -2.5398      -2.5630  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Hurdle Poisson model</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu">glmmTMB</span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">spp</span> <span class="op">+</span> <span class="va">mined</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">site</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  zi<span class="op">=</span><span class="op">~</span><span class="va">spp</span> <span class="op">+</span> <span class="va">mined</span>,</span></span>
<span class="r-in"><span>  family<span class="op">=</span><span class="va">truncated_poisson</span>, data<span class="op">=</span><span class="va">Salamanders</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula:          count ~ spp + mined + (1 | site)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Zero inflation:         ~spp + mined</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: Salamanders</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       AIC       BIC    logLik  df.resid </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1790.1669 1866.1177 -878.0834       627 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random-effects (co)variances:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups Name        Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  site   (Intercept) 0.2306  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs: 644 / Conditional model: site, 23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed Effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)        sppPR        sppDM      sppEC-A      sppEC-L     sppDES-L  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    -0.06702     -0.52093      0.22458     -0.19548      0.64672      0.60514  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sppDF      minedno  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     0.04602      1.01447  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Zero-inflation model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)        sppPR        sppDM      sppEC-A      sppEC-L     sppDES-L  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      1.7556       1.6785      -0.4269       1.1046      -0.4269      -0.6716  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sppDF      minedno  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -0.4269      -2.4038  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Binomial model</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cbpp</span>, package<span class="op">=</span><span class="st">"lme4"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">bovine</span> <span class="op">&lt;-</span> <span class="fu">glmmTMB</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">incidence</span>, <span class="va">size</span><span class="op">-</span><span class="va">incidence</span><span class="op">)</span> <span class="op">~</span> <span class="va">period</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">herd</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  family<span class="op">=</span><span class="va">binomial</span>, data<span class="op">=</span><span class="va">cbpp</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula:          cbind(incidence, size - incidence) ~ period + (1 | herd)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data: cbpp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       AIC       BIC    logLik  df.resid </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 194.05256 204.17932 -92.02628        51 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random-effects (co)variances:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups Name        Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  herd   (Intercept) 0.6423  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs: 56 / Conditional model: herd, 15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed Effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)      period2      period3      period4  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -1.3985      -0.9923      -1.1287      -1.5803  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Dispersion model</span></span></span>
<span class="r-in"><span><span class="va">sim1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nfac</span><span class="op">=</span><span class="fl">40</span>, <span class="va">nt</span><span class="op">=</span><span class="fl">100</span>, <span class="va">facsd</span><span class="op">=</span><span class="fl">0.1</span>, <span class="va">tsd</span><span class="op">=</span><span class="fl">0.15</span>, <span class="va">mu</span><span class="op">=</span><span class="fl">0</span>, <span class="va">residsd</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>fac<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">nfac</span><span class="op">]</span><span class="op">)</span>, t<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">nt</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">dat</span><span class="op">$</span><span class="va">REfac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nfac</span>, sd<span class="op">=</span><span class="va">facsd</span><span class="op">)</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">fac</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">dat</span><span class="op">$</span><span class="va">REt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nt</span>, sd<span class="op">=</span><span class="va">tsd</span><span class="op">)</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">t</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">dat</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean<span class="op">=</span><span class="va">mu</span>, sd<span class="op">=</span><span class="va">residsd</span><span class="op">)</span> <span class="op">+</span> <span class="va">dat</span><span class="op">$</span><span class="va">REfac</span> <span class="op">+</span> <span class="va">dat</span><span class="op">$</span><span class="va">REt</span></span></span>
<span class="r-in"><span>  <span class="va">dat</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu">sim1</span><span class="op">(</span>mu<span class="op">=</span><span class="fl">100</span>, residsd<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu">sim1</span><span class="op">(</span>mu<span class="op">=</span><span class="fl">200</span>, residsd<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d1</span><span class="op">$</span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="st">"ten"</span></span></span>
<span class="r-in"><span><span class="va">d2</span><span class="op">$</span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="st">"five"</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">d2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu">glmmTMB</span><span class="op">(</span><span class="va">x</span> <span class="op">~</span> <span class="va">sd</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">t</span><span class="op">)</span>, dispformula<span class="op">=</span><span class="op">~</span><span class="va">sd</span>, data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="fixef.html">fixef</a></span><span class="op">(</span><span class="va">m0</span><span class="op">)</span><span class="op">$</span><span class="va">disp</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)       sdten </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    3.202870    1.386476 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">5</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">5</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># expected dispersion model coefficients</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3.218876 1.386294</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Using 'map' to fix random-effects SD to 10</span></span></span>
<span class="r-in"><span><span class="va">m1_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m1</span>, map<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="VarCorr.glmmTMB.html">VarCorr</a></span><span class="op">(</span><span class="va">m1_map</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional model:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups Name        Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  site   (Intercept) 10      </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## smooth terms</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Nile"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ndat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">Nile</span><span class="op">)</span><span class="op">)</span>, val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Nile</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sm1</span> <span class="op">&lt;-</span> <span class="fu">glmmTMB</span><span class="op">(</span><span class="va">val</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">time</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">ndat</span>,</span></span>
<span class="r-in"><span>               REML <span class="op">=</span> <span class="cn">TRUE</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">val</span> <span class="op">~</span> <span class="va">time</span>, data <span class="op">=</span> <span class="va">ndat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ndat</span><span class="op">$</span><span class="va">time</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">sm1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="glmmTMB-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mollie Brooks, Ben Bolker, Kasper Kristensen, Martin Maechler, Arni Magnusson, Hans Skaug, Anders Nielsen, Casper Berg, Koen van Bentham.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7 and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9003.</p>
</div>

      </footer></div>

  


  

  </body></html>

