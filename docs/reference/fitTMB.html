<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Optimize TMB models and package results, modularly — fitTMB • glmmTMB</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Optimize TMB models and package results, modularly — fitTMB"><meta property="og:description" content="These functions (called internally by glmmTMB) perform
the actual model optimization, after all of the appropriate structures
have been set up (fitTMB), and finalize the model after
optimization (finalizeTMB). It can be useful to run glmmTMB with
doFit=FALSE, adjust the components as required, and then
finish the fitting process with fitTMB (however, it is the
user's responsibility to make sure that any modifications
create an internally consistent final fitted object)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-standard navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">glmmTMB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.8-9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/glmmTMB.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/covstruct.html">Covariance structures with glmmTMB</a>
    </li>
    <li>
      <a href="../articles/hacking.html">Hacking glmmTMB</a>
    </li>
    <li>
      <a href="../articles/mcmc.html">Post-hoc MCMC with glmmTMB</a>
    </li>
    <li>
      <a href="../articles/miscEx.html">Miscellaneous examples</a>
    </li>
    <li>
      <a href="../articles/model_evaluation.html">Model evaluation</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel optimization using glmmTMB</a>
    </li>
    <li>
      <a href="../articles/priors.html">Priors in glmmTMB</a>
    </li>
    <li>
      <a href="../articles/sim.html">Simulate from a fitted glmmTMB model or a formula</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting with glmmTMB</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="../repos/index.html">
    <span class="fa fa-database fa-lg"></span>
     
    binary packages
  </a>
</li>
<li>
  <a href="https://github.com/glmmTMB/glmmTMB" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Optimize TMB models and package results, modularly</h1>
    <small class="dont-index">Source: <a href="https://github.com/glmmTMB/glmmTMB/blob/HEAD/R/glmmTMB.R" class="external-link"><code>R/glmmTMB.R</code></a></small>
    <div class="hidden name"><code>fitTMB.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These functions (called internally by <code><a href="glmmTMB.html">glmmTMB</a></code>) perform
the actual model optimization, after all of the appropriate structures
have been set up (<code>fitTMB</code>), and finalize the model after
optimization (<code>finalizeTMB</code>). It can be useful to run <code><a href="glmmTMB.html">glmmTMB</a></code> with
<code>doFit=FALSE</code>, adjust the components as required, and then
finish the fitting process with <code>fitTMB</code> (however, it is the
user's responsibility to make sure that any modifications
create an internally consistent final fitted object).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fitTMB</span><span class="op">(</span><span class="va">TMBStruc</span>, doOptim <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">finalizeTMB</span><span class="op">(</span><span class="va">TMBStruc</span>, <span class="va">obj</span>, <span class="va">fit</span>, h <span class="op">=</span> <span class="cn">NULL</span>, data.tmb.old <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>TMBStruc</dt>
<dd><p>a list containing lots of stuff ...</p></dd>


<dt>doOptim</dt>
<dd><p>logical; do optimization? If FALSE, return TMB object</p></dd>


<dt>obj</dt>
<dd><p>object created by <code>fitTMB(., doOptim = FALSE)</code></p></dd>


<dt>fit</dt>
<dd><p>a fitted object returned from <code>nlminb</code>, or more generally
a similar list (i.e. containing elements <code>par</code>, <code>objective</code>, <code>convergence</code>,
<code>message</code>, <code>iterations</code>, <code>evaluations</code>)</p></dd>


<dt>h</dt>
<dd><p>Hessian matrix for fit, if computed in previous step</p></dd>


<dt>data.tmb.old</dt>
<dd><p>stored TMB data, if computed in previous step</p></dd>

</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## regular (non-modular) model fit</span></span></span>
<span class="r-in"><span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="glmmTMB.html">glmmTMB</a></span><span class="op">(</span><span class="va">count</span> <span class="op">~</span> <span class="va">mined</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">site</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             family<span class="op">=</span><span class="va">poisson</span>, data<span class="op">=</span><span class="va">Salamanders</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## construct model structures</span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m0</span>, doFit<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">m0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "obj"       "fit"       "sdr"       "call"      "frame"     "modelInfo"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7] "fitted"   </span>
<span class="r-in"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu">fitTMB</span><span class="op">(</span><span class="va">m1</span>, doOptim <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## could modify the components of m1$env$data at this point ...</span></span></span>
<span class="r-in"><span><span class="co">## rebuild TMB structure (*may* be necessary)</span></span></span>
<span class="r-in"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">m2</span><span class="op">$</span><span class="va">env</span>,</span></span>
<span class="r-in"><span>               <span class="fu">TMB</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">MakeADFun</a></span><span class="op">(</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>                               <span class="va">parameters</span>,</span></span>
<span class="r-in"><span>                               map <span class="op">=</span> <span class="va">map</span>,</span></span>
<span class="r-in"><span>                               random <span class="op">=</span> <span class="va">random</span>,</span></span>
<span class="r-in"><span>                               silent <span class="op">=</span> <span class="va">silent</span>,</span></span>
<span class="r-in"><span>                               DLL <span class="op">=</span> <span class="st">"glmmTMB"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">m2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></span><span class="op">(</span><span class="va">par</span>, objective <span class="op">=</span> <span class="va">fn</span>, gr <span class="op">=</span> <span class="va">gr</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu">finalizeTMB</span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span>, <span class="va">m3</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mollie Brooks, Ben Bolker, Kasper Kristensen, Martin Maechler, Arni Magnusson, Hans Skaug, Anders Nielsen, Casper Berg, Koen van Bentham.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7 and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9003.</p>
</div>

      </footer></div>

  


  

  </body></html>

