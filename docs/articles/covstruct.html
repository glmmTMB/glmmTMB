<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Kasper Kristensen and Maeve McGillycuddy" />

<meta name="date" content="2023-10-14" />

<title>Covariance structures with glmmTMB</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Covariance structures with glmmTMB</h1>
<h4 class="author">Kasper Kristensen and Maeve McGillycuddy</h4>
<h4 class="date">2023-10-14</h4>


<div id="TOC">
<ul>
<li><a href="#the-ar1-covariance-structure" id="toc-the-ar1-covariance-structure">The AR(1) covariance structure</a>
<ul>
<li><a href="#demonstration-on-simulated-data" id="toc-demonstration-on-simulated-data">Demonstration on simulated
data</a></li>
<li><a href="#increasing-the-sample-size" id="toc-increasing-the-sample-size">Increasing the sample size</a></li>
</ul></li>
<li><a href="#the-unstructured-covariance" id="toc-the-unstructured-covariance">The unstructured
covariance</a></li>
<li><a href="#the-toeplitz-structure" id="toc-the-toeplitz-structure">The Toeplitz structure</a></li>
<li><a href="#compound-symmetry" id="toc-compound-symmetry">Compound
symmetry</a></li>
<li><a href="#anova-tables" id="toc-anova-tables">Anova tables</a></li>
<li><a href="#adding-coordinate-information" id="toc-adding-coordinate-information">Adding coordinate
information</a></li>
<li><a href="#ornsteinuhlenbeck" id="toc-ornsteinuhlenbeck">Ornstein–Uhlenbeck</a></li>
<li><a href="#spatial-correlations" id="toc-spatial-correlations">Spatial correlations</a>
<ul>
<li><a href="#matern" id="toc-matern">Matern</a></li>
<li><a href="#gaussian" id="toc-gaussian">Gaussian</a></li>
<li><a href="#exponential" id="toc-exponential">Exponential</a></li>
<li><a href="#a-spatial-covariance-example" id="toc-a-spatial-covariance-example">A spatial covariance
example</a></li>
</ul></li>
<li><a href="#mappings" id="toc-mappings">Mappings</a>
<ul>
<li><a href="#unstructured" id="toc-unstructured">Unstructured</a></li>
</ul></li>
<li><a href="#general-latent-variable-model" id="toc-general-latent-variable-model">General latent variable model</a>
<ul>
<li><a href="#reduced-rank" id="toc-reduced-rank">Reduced rank</a></li>
</ul></li>
<li><a href="#construction-of-structured-covariance-matrices" id="toc-construction-of-structured-covariance-matrices">Construction of
structured covariance matrices</a></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<p>This vignette demonstrates some of the covariance structures
available in the <code>glmmTMB</code> package. Currently the available
covariance structures are:</p>
<!-- not sure why |x| for abs value isn't working in MathJax/LateX within kable table ... -->
<table>
<colgroup>
<col width="20%" />
<col width="4%" />
<col width="7%" />
<col width="9%" />
<col width="58%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Covariance</th>
<th align="left">Notation</th>
<th align="left">no. parameters</th>
<th align="left">Requirement</th>
<th align="left">Parameters</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Unstructured (general positive definite)</td>
<td align="left"><code>us</code></td>
<td align="left"><span class="math inline">\(n(n+1)/2\)</span></td>
<td align="left"></td>
<td align="left">See <a href="#mappings">Mappings</a></td>
</tr>
<tr class="even">
<td align="left">Heterogeneous Toeplitz</td>
<td align="left"><code>toep</code></td>
<td align="left"><span class="math inline">\(2n-1\)</span></td>
<td align="left"></td>
<td align="left">log-SDs (<span class="math inline">\(\theta_1-\theta_n\)</span>); correlations <span class="math inline">\(\rho_k =
\theta_{n+k}/\sqrt{1+\theta_{n+k}^2}\)</span>, <span class="math inline">\(k = \textrm{abs}(i-j+1)\)</span></td>
</tr>
<tr class="odd">
<td align="left">Het. compound symmetry</td>
<td align="left"><code>cs</code></td>
<td align="left"><span class="math inline">\(n+1\)</span></td>
<td align="left"></td>
<td align="left">log-SDs (<span class="math inline">\(\theta_1-\theta_n\)</span>); correlation <span class="math inline">\(\rho =
\theta_{n+1}/\sqrt{1+\theta_{n+1}^2}\)</span></td>
</tr>
<tr class="even">
<td align="left">Het. diagonal</td>
<td align="left"><code>diag</code></td>
<td align="left"><span class="math inline">\(n\)</span></td>
<td align="left"></td>
<td align="left">log-SDs</td>
</tr>
<tr class="odd">
<td align="left">AR(1)</td>
<td align="left"><code>ar1</code></td>
<td align="left"><span class="math inline">\(2\)</span></td>
<td align="left">Unit spaced levels</td>
<td align="left">log-SD; <span class="math inline">\(\rho =
\left(\theta_2/\sqrt{1+\theta_2^2}\right)^{d_{ij}}\)</span></td>
</tr>
<tr class="even">
<td align="left">Ornstein-Uhlenbeck</td>
<td align="left"><code>ou</code></td>
<td align="left"><span class="math inline">\(2\)</span></td>
<td align="left">Coordinates</td>
<td align="left">log-SD; log-OU rate (<span class="math inline">\(\rho =
\exp(-\exp(\theta_2) d_{ij})\)</span>)</td>
</tr>
<tr class="odd">
<td align="left">Spatial exponential</td>
<td align="left"><code>exp</code></td>
<td align="left"><span class="math inline">\(2\)</span></td>
<td align="left">Coordinates</td>
<td align="left">log-SD; log-scale (<span class="math inline">\(\rho =
\exp(-\exp(-\theta_2) d_{ij})\)</span>)</td>
</tr>
<tr class="even">
<td align="left">Spatial Gaussian</td>
<td align="left"><code>gau</code></td>
<td align="left"><span class="math inline">\(2\)</span></td>
<td align="left">Coordinates</td>
<td align="left">log-SD; log-scale (<span class="math inline">\(\rho =
\exp(-\exp(-2\theta_2) d_{ij}^2\)</span>)</td>
</tr>
<tr class="odd">
<td align="left">Spatial Matèrn</td>
<td align="left"><code>mat</code></td>
<td align="left"><span class="math inline">\(3\)</span></td>
<td align="left">Coordinates</td>
<td align="left">log-SD, log-range, log-shape (power)</td>
</tr>
<tr class="even">
<td align="left">Reduced rank</td>
<td align="left"><code>rr</code></td>
<td align="left"><span class="math inline">\(nd-d(d-1)/2\)</span></td>
<td align="left">rank (d)</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>The word ‘heterogeneous’ refers to the marginal variances of the
model.</p>
<p>Some of the structures require temporal or spatial coordinates. We
will show examples of this in a later section.</p>
<div id="the-ar1-covariance-structure" class="section level2">
<h2>The AR(1) covariance structure</h2>
<div id="demonstration-on-simulated-data" class="section level3">
<h3>Demonstration on simulated data</h3>
<p>First, let’s consider a simple time series model. Assume that our
measurements <span class="math inline">\(Y(t)\)</span> are given at
discrete times <span class="math inline">\(t \in \{1,...,n\}\)</span>
by</p>
<p><span class="math display">\[Y(t) = \mu + X(t) +
\varepsilon(t)\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\mu\)</span> is the mean value
parameter.</li>
<li><span class="math inline">\(X(t)\)</span> is a stationary AR(1)
process, i.e. has covariance <span class="math inline">\(cov(X(s), X(t))
= \sigma^2\exp(-\theta |t-s|)\)</span>.</li>
<li><span class="math inline">\(\varepsilon(t)\)</span> is iid. <span class="math inline">\(N(0,\sigma_0^2)\)</span> measurement error.</li>
</ul>
<p>A simulation experiment is set up using the parameters</p>
<table>
<thead>
<tr class="header">
<th>Description</th>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean</td>
<td><span class="math inline">\(\mu\)</span></td>
<td>0</td>
</tr>
<tr class="even">
<td>Process variance</td>
<td><span class="math inline">\(\sigma^2\)</span></td>
<td>1</td>
</tr>
<tr class="odd">
<td>Measurement variance</td>
<td><span class="math inline">\(\sigma_0^2\)</span></td>
<td>1</td>
</tr>
<tr class="even">
<td>One-step correlation</td>
<td><span class="math inline">\(\phi\)</span></td>
<td>0.7</td>
</tr>
</tbody>
</table>
<p>The following R-code draws a simulation based on these parameter
values. For illustration purposes we consider a very short time
series.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">25</span>                                              <span class="do">## Number of time points</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">mu =</span> <span class="fu">rep</span>(<span class="dv">0</span>,n),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">Sigma =</span> .<span class="dv">7</span> <span class="sc">^</span> <span class="fu">as.matrix</span>(<span class="fu">dist</span>(<span class="dv">1</span><span class="sc">:</span>n)) )    <span class="do">## Simulate the process using the MASS package</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n)                                   <span class="do">## Add measurement noise</span></span></code></pre></div>
<p>In order to fit the model with <code>glmmTMB</code> we must first
specify a time variable as a <em>factor</em>. The factor <em>levels</em>
correspond to unit spaced time points. It is a common mistake to forget
some factor levels due to missing data or to order the levels
incorrectly. We therefore recommend to construct factors with explicit
levels, using the <code>levels</code> argument to the
<code>factor</code> function:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">levels=</span><span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">levels</span>(times))</span></code></pre></div>
<pre><code>## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot;</code></pre>
<p>We also need a grouping variable. In the current case there is only
one time-series so the grouping is:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span>,n))</span></code></pre></div>
<p>We combine the data into a single data frame (not absolutely
required, but good practice):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(y, times, group)</span></code></pre></div>
<p>Now fit the model using</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glmmTMB</span>(y <span class="sc">~</span> <span class="fu">ar1</span>(times <span class="sc">+</span> <span class="dv">0</span> <span class="sc">|</span> group), <span class="at">data=</span>dat0)</span></code></pre></div>
<p>This formula notation follows that of the <code>lme4</code>
package.</p>
<ul>
<li>The left hand side of the bar <code>times + 0</code> corresponds to
a design matrix <span class="math inline">\(Z\)</span> linking
observation vector <span class="math inline">\(y\)</span> (rows) with a
random effects vector <span class="math inline">\(u\)</span> (columns)
(see <a href="#construction-of-structured-covariance-matrices">Construction of
structured covariance matrices</a> for why we need the
<code>+ 0</code>)</li>
<li>The distribution of <span class="math inline">\(u\)</span> is
<code>ar1</code> (this is the only <code>glmmTMB</code> specific part of
the formula).</li>
<li>The right hand side of the bar splits the above specification
independently among groups. Each group has its own separate <span class="math inline">\(u\)</span> vector but shares the same parameters
for the covariance structure.</li>
</ul>
<p>After running the model, we find the parameter estimates <span class="math inline">\(\mu\)</span> (intercept), <span class="math inline">\(\sigma_0^2\)</span> (dispersion), <span class="math inline">\(\sigma\)</span> (Std. Dev.) and <span class="math inline">\(\phi\)</span> (First off-diagonal of “Corr”) in
the output:</p>
<pre><code>## Formula:          y ~ ar1(times + 0 | group)
## Data: dat0
##       AIC       BIC    logLik  df.resid 
##  77.41777  82.29328 -34.70889        21 
## Random-effects (co)variances:
## 
## Conditional model:
##  Groups   Name   Std.Dev.  Corr      
##  group    times1 1.093e+00 0.47 (ar1)
##  Residual        5.898e-05           
## 
## Number of obs: 25 / Conditional model: group, 1
## 
## Dispersion estimate for gaussian family (sigma^2): 3.48e-09 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##    -0.09745</code></pre>
<p>For those trying to make sense of the internal parameterization, the
internal transformation from the parameter (<span class="math inline">\(\phi\)</span>) to the AR1 coefficient is <span class="math inline">\(\phi = \theta_2/\sqrt(1+\theta_2^2)\)</span>; the
inverse transformation is <span class="math inline">\(\theta_2 =
\phi/\sqrt(1-\phi^2)\)</span>. (The first element of the
<code>theta</code> vector is the log-standard-deviation.)</p>
</div>
<div id="increasing-the-sample-size" class="section level3">
<h3>Increasing the sample size</h3>
<p>A single time series of 6 time points is not sufficient to identify
the parameters. We could either increase the length of the time series
or increase the number of groups. We’ll try the latter:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>simGroup <span class="ot">&lt;-</span> <span class="cf">function</span>(g, <span class="at">n=</span><span class="dv">6</span>, <span class="at">phi=</span><span class="fl">0.7</span>) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">mu =</span> <span class="fu">rep</span>(<span class="dv">0</span>,n),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">Sigma =</span> phi <span class="sc">^</span> <span class="fu">as.matrix</span>(<span class="fu">dist</span>(<span class="dv">1</span><span class="sc">:</span>n)) )   <span class="do">## Simulate the process</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n)                               <span class="do">## Add measurement noise</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    times <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    group <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(g,n))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(y, times, group)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">simGroup</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##             y times group
## 1 -1.05644751     1     1
## 2 -1.44135897     2     1
## 3 -0.02632749     3     1
## 4 -0.07130971     4     1
## 5  1.44678696     5     1
## 6  0.85709093     6     1</code></pre>
<p>Generate a dataset with 1000 groups:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, simGroup) )</span></code></pre></div>
<p>And fitting the model on this larger dataset gives estimates close to
the true values (AR standard deviation=1, residual (measurement)
standard deviation=1, autocorrelation=0.7):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(fit.ar1 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> <span class="fu">ar1</span>(times <span class="sc">+</span> <span class="dv">0</span> <span class="sc">|</span> group), <span class="at">data=</span>dat1))</span></code></pre></div>
<pre><code>## Formula:          y ~ ar1(times + 0 | group)
## Data: dat1
##       AIC       BIC    logLik  df.resid 
##  20748.59  20775.39 -10370.30      5996 
## Random-effects (co)variances:
## 
## Conditional model:
##  Groups   Name   Std.Dev. Corr      
##  group    times1 1.0695   0.70 (ar1)
##  Residual        0.9951             
## 
## Number of obs: 6000 / Conditional model: group, 1000
## 
## Dispersion estimate for gaussian family (sigma^2): 0.99 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##     0.02553</code></pre>
</div>
</div>
<div id="the-unstructured-covariance" class="section level2">
<h2>The unstructured covariance</h2>
<p>We can try to fit an unstructured covariance to the previous dataset
<code>dat</code>. For this case an unstructured covariance has 300
correlation parameters and 25 variance parameters. Adding <span class="math inline">\(\sigma_0^2 I\)</span> on top would cause a strict
overparameterization, as these would be redundant with the diagonal
elements in the covariance matrix. Hence, when fitting the model with
<code>glmmTMB</code>, we have to disable the <span class="math inline">\(\varepsilon\)</span> term (the dispersion) by
setting <code>dispformula=~0</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fit.us <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> <span class="fu">us</span>(times <span class="sc">+</span> <span class="dv">0</span> <span class="sc">|</span> group), <span class="at">data=</span>dat1, <span class="at">dispformula=</span><span class="sc">~</span><span class="dv">0</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>fit.us<span class="sc">$</span>sdr<span class="sc">$</span>pdHess <span class="do">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The estimated variance and correlation parameters are:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(fit.us)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name   Std.Dev. Corr                          
##  group  times1 1.5313                                 
##         times2 1.4346   0.403                         
##         times3 1.4427   0.260 0.340                   
##         times4 1.4712   0.194 0.266 0.399             
##         times5 1.4539   0.108 0.167 0.254 0.342       
##         times6 1.4223   0.031 0.096 0.194 0.268 0.358</code></pre>
<p>The estimated correlation is approximately constant along diagonals
(apparent Toeplitz structure) and we note that the first off-diagonal is
now ca. half the true value (0.7) because the dispersion is effectively
included in the estimated covariance matrix (i.e. <span class="math inline">\(\rho&#39; = \rho \sigma^2_{{\text
{AR}}}/(\sigma^2_{{\text {AR}}} + \sigma^2_{{\text
{meas}}})\)</span>).</p>
</div>
<div id="the-toeplitz-structure" class="section level2">
<h2>The Toeplitz structure</h2>
<p>The next natural step would be to reduce the number of parameters by
collecting correlation parameters within the same off-diagonal. This
amounts to 24 correlation parameters and 25 variance parameters.</p>
<p>We use <code>dispformula = ~0</code> to suppress the residual
variance (it actually gets set to a small value controlled by the
<code>zerodisp_val</code> argument of <code>glmmTMBControl()</code>)<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fit.toep <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> <span class="fu">toep</span>(times <span class="sc">+</span> <span class="dv">0</span> <span class="sc">|</span> group), <span class="at">data=</span>dat1,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dispformula=</span><span class="sc">~</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>## Warning in (function (start, objective, gradient = NULL, hessian = NULL, :
## NA/NaN function evaluation</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fit.toep<span class="sc">$</span>sdr<span class="sc">$</span>pdHess <span class="do">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The estimated variance and correlation parameters are:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(vc.toep <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(fit.toep))</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name   Std.Dev. Corr                          
##  group  times1 1.5227                                 
##         times2 1.4329   0.370                         
##         times3 1.4436   0.264 0.370                   
##         times4 1.4705   0.185 0.264 0.370             
##         times5 1.4638   0.106 0.185 0.264 0.370       
##         times6 1.4249   0.028 0.106 0.185 0.264 0.370</code></pre>
<p>The diagonal elements are all approximately equal to the true total
variance (<span class="math inline">\(\sigma^2_{{\text {AR}}} +
\sigma^2_{{\text {meas}}}\)</span>=2), and the off-diagonal elements are
approximately equal to the expected value of 0.7/2=0.35.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>vc1 <span class="ot">&lt;-</span> vc.toep<span class="sc">$</span>cond[[<span class="dv">1</span>]] <span class="do">## first term of var-cov for RE of conditional model</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">diag</span>(vc1))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   2.030   2.061   2.113   2.132   2.158   2.319</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(vc1[<span class="fu">row</span>(vc1)<span class="sc">!=</span><span class="fu">col</span>(vc1)])</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0611  0.3821  0.5561  0.5246  0.7696  0.8067</code></pre>
<p>We can get a <em>slightly</em> better estimate of the variance by
using REML estimation (however, the estimate of the correlations seems
to have gotten slightly worse):</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fit.toep.reml <span class="ot">&lt;-</span> <span class="fu">update</span>(fit.toep, <span class="at">REML=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning in finalizeTMB(TMBStruc, obj, fit, h, data.tmb.old): Model convergence
## problem; false convergence (8). See vignette(&#39;troubleshooting&#39;),
## help(&#39;diagnose&#39;)</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>vc1R <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(fit.toep.reml)<span class="sc">$</span>cond[[<span class="dv">1</span>]]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">diag</span>(vc1R))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   2.031   2.062   2.114   2.133   2.158   2.319</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(vc1R[<span class="fu">row</span>(vc1R)<span class="sc">!=</span><span class="fu">col</span>(vc1R)])</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.06185 0.38288 0.55688 0.52532 0.77038 0.80750</code></pre>
</div>
<div id="compound-symmetry" class="section level2">
<h2>Compound symmetry</h2>
<p>The compound symmetry structure collects all off-diagonal elements of
the correlation matrix to one common value.</p>
<p>We again use <code>dispformula = ~0</code> to make the model
parameters identifiable (see the footnote in <a href="#the-toeplitz-structure">The Toeplitz structure</a>; a similar,
although slightly simpler, argument applies here).</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fit.cs <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> <span class="fu">cs</span>(times <span class="sc">+</span> <span class="dv">0</span> <span class="sc">|</span> group), <span class="at">data=</span>dat1, <span class="at">dispformula=</span><span class="sc">~</span><span class="dv">0</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fit.cs<span class="sc">$</span>sdr<span class="sc">$</span>pdHess <span class="do">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The estimated variance and correlation parameters are:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(fit.cs)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name   Std.Dev. Corr      
##  group  times1 1.5554   0.246 (cs)
##         times2 1.4302             
##         times3 1.4220             
##         times4 1.4478             
##         times5 1.4543             
##         times6 1.4491</code></pre>
</div>
<div id="anova-tables" class="section level2">
<h2>Anova tables</h2>
<p>The models <code>ar1</code>, <code>toep</code>, and <code>us</code>
are nested so we can use:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit.ar1, fit.toep, fit.us)</span></code></pre></div>
<pre><code>## Data: dat1
## Models:
## fit.ar1: y ~ ar1(times + 0 | group), zi=~0, disp=~1
## fit.toep: y ~ toep(times + 0 | group), zi=~0, disp=~0
## fit.us: y ~ us(times + 0 | group), zi=~0, disp=~0
##          Df   AIC   BIC logLik deviance   Chisq Chi Df Pr(&gt;Chisq)
## fit.ar1   4 20749 20775 -10370    20741                          
## fit.toep 12 20753 20833 -10364    20729 11.8164      8     0.1596
## fit.us   22 20766 20913 -10361    20722  7.0402     10     0.7216</code></pre>
<p><code>ar1</code> has the lowest AIC (it’s the simplest model, and
fits the data adequately); we can’t reject the (true in this case!) null
model that an AR1 structure is adequate to describe the data.</p>
<p>The model <code>cs</code> is a sub-model of <code>toep</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit.cs, fit.toep)</span></code></pre></div>
<pre><code>## Data: dat1
## Models:
## fit.cs: y ~ cs(times + 0 | group), zi=~0, disp=~0
## fit.toep: y ~ toep(times + 0 | group), zi=~0, disp=~0
##          Df   AIC   BIC logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    
## fit.cs    8 20966 21020 -10475    20950                             
## fit.toep 12 20753 20833 -10364    20729 221.15      4  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Here we <em>can</em> reject the null hypothesis of compound symmetry
(i.e., that all the pairwise correlations are the same).</p>
</div>
<div id="adding-coordinate-information" class="section level2">
<h2>Adding coordinate information</h2>
<p>Coordinate information can be added to a variable using the
<code>glmmTMB</code> function <code>numFactor</code>. This is necessary
in order to use those covariance structures that require coordinates.
For example, if we have the numeric coordinates</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">10</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">10</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>we can generate a factor representing <span class="math inline">\((x,y)\)</span> coordinates by</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>(pos <span class="ot">&lt;-</span> <span class="fu">numFactor</span>(x,y))</span></code></pre></div>
<pre><code>##  [1] (1,1) (2,1) (1,1) (1,1) (1,2) (1,1) (1,2) (1,1) (1,1) (1,2)
## Levels: (1,1) (2,1) (1,2)</code></pre>
<p>Numeric coordinates can be recovered from the factor levels:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parseNumLevels</span>(<span class="fu">levels</span>(pos))</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    1
## [2,]    2    1
## [3,]    1    2</code></pre>
<p>In order to try the remaining structures on our test data we
re-interpret the time factor using <code>numFactor</code>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dat1<span class="sc">$</span>times <span class="ot">&lt;-</span> <span class="fu">numFactor</span>(dat1<span class="sc">$</span>times)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dat1<span class="sc">$</span>times)</span></code></pre></div>
<pre><code>## [1] &quot;(1)&quot; &quot;(2)&quot; &quot;(3)&quot; &quot;(4)&quot; &quot;(5)&quot; &quot;(6)&quot;</code></pre>
</div>
<div id="ornsteinuhlenbeck" class="section level2">
<h2>Ornstein–Uhlenbeck</h2>
<p>Having the numeric times encoded in the factor levels we can now try
the Ornstein–Uhlenbeck covariance structure.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fit.ou <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> <span class="fu">ou</span>(times <span class="sc">+</span> <span class="dv">0</span> <span class="sc">|</span> group), <span class="at">data=</span>dat1)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fit.ou<span class="sc">$</span>sdr<span class="sc">$</span>pdHess <span class="do">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>It should give the exact same results as <code>ar1</code> in this
case since the times are equidistant:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(fit.ou)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups   Name     Std.Dev. Corr                          
##  group    times(1) 1.06953                                
##           times(2) 1.06953  0.695                         
##           times(3) 1.06953  0.483 0.695                   
##           times(4) 1.06953  0.336 0.483 0.695             
##           times(5) 1.06953  0.233 0.336 0.483 0.695       
##           times(6) 1.06953  0.162 0.233 0.336 0.483 0.695 
##  Residual          0.99511</code></pre>
<p>However, note the differences between <code>ou</code> and
<code>ar1</code>:</p>
<ul>
<li><code>ou</code> can handle irregular time points.</li>
<li><code>ou</code> only allows positive correlation between neighboring
time points.</li>
</ul>
</div>
<div id="spatial-correlations" class="section level2">
<h2>Spatial correlations</h2>
<p>The structures <code>exp</code>, <code>gau</code> and
<code>mat</code> are meant to used for spatial data. They all require a
Euclidean distance matrix which is calculated internally based on the
coordinates. Here, we will try these models on the simulated time series
data.</p>
<p>An example with spatial data is presented in a later section.</p>
<div id="matern" class="section level3">
<h3>Matern</h3>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fit.mat <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> <span class="fu">mat</span>(times <span class="sc">+</span> <span class="dv">0</span> <span class="sc">|</span> group), <span class="at">data=</span>dat1, <span class="at">dispformula=</span><span class="sc">~</span><span class="dv">0</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>fit.mat<span class="sc">$</span>sdr<span class="sc">$</span>pdHess <span class="do">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(fit.mat)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name     Std.Dev. Corr                          
##  group  times(1) 1.4603                                 
##         times(2) 1.4603   0.373                         
##         times(3) 1.4603   0.250 0.373                   
##         times(4) 1.4603   0.178 0.250 0.373             
##         times(5) 1.4603   0.131 0.178 0.250 0.373       
##         times(6) 1.4603   0.097 0.131 0.178 0.250 0.373</code></pre>
</div>
<div id="gaussian" class="section level3">
<h3>Gaussian</h3>
<p>“Gaussian” refers here to a Gaussian decay in correlation with
distance, i.e. <span class="math inline">\(\rho = \exp(-d x^2)\)</span>,
not to the conditional distribution (“family”).</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fit.gau <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> <span class="fu">gau</span>(times <span class="sc">+</span> <span class="dv">0</span> <span class="sc">|</span> group), <span class="at">data=</span>dat1, <span class="at">dispformula=</span><span class="sc">~</span><span class="dv">0</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fit.gau<span class="sc">$</span>sdr<span class="sc">$</span>pdHess <span class="do">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(fit.gau)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name     Std.Dev. Corr                          
##  group  times(1) 1.4458                                 
##         times(2) 1.4458   0.286                         
##         times(3) 1.4458   0.007 0.286                   
##         times(4) 1.4458   0.000 0.007 0.286             
##         times(5) 1.4458   0.000 0.000 0.007 0.286       
##         times(6) 1.4458   0.000 0.000 0.000 0.007 0.286</code></pre>
</div>
<div id="exponential" class="section level3">
<h3>Exponential</h3>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fit.exp <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(y <span class="sc">~</span> <span class="fu">exp</span>(times <span class="sc">+</span> <span class="dv">0</span> <span class="sc">|</span> group), <span class="at">data=</span>dat1)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>fit.exp<span class="sc">$</span>sdr<span class="sc">$</span>pdHess <span class="do">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VarCorr</span>(fit.exp)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups   Name     Std.Dev. Corr                          
##  group    times(1) 1.06953                                
##           times(2) 1.06953  0.695                         
##           times(3) 1.06953  0.483 0.695                   
##           times(4) 1.06953  0.336 0.483 0.695             
##           times(5) 1.06953  0.233 0.336 0.483 0.695       
##           times(6) 1.06953  0.162 0.233 0.336 0.483 0.695 
##  Residual          0.99511</code></pre>
</div>
<div id="a-spatial-covariance-example" class="section level3">
<h3>A spatial covariance example</h3>
<p>Starting out with the built in <code>volcano</code> dataset we
reshape it to a <code>data.frame</code> with pixel intensity
<code>z</code> and pixel position <code>x</code> and <code>y</code>:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">z =</span> <span class="fu">as.vector</span>(volcano),</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> <span class="fu">as.vector</span>(<span class="fu">row</span>(volcano)),</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> <span class="fu">as.vector</span>(<span class="fu">col</span>(volcano)))</span></code></pre></div>
<p>Next, add random normal noise to the pixel intensities and extract a
small subset of 100 pixels. This is our spatial dataset:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>z <span class="ot">&lt;-</span> d<span class="sc">$</span>z <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(volcano), <span class="at">sd=</span><span class="dv">15</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[<span class="fu">sample</span>(<span class="fu">nrow</span>(d), <span class="dv">100</span>), ]</span></code></pre></div>
<p>Display sampled noisy volcano data:</p>
<!-- never evaluate -->
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>volcano.data <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="cn">NA</span>, <span class="fu">dim</span>(volcano))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>volcano.data[<span class="fu">cbind</span>(d<span class="sc">$</span>x, d<span class="sc">$</span>y)] <span class="ot">&lt;-</span> d<span class="sc">$</span>z</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(volcano.data, <span class="at">main=</span><span class="st">&quot;Spatial data&quot;</span>, <span class="at">useRaster=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<!-- evaluate if NOT_CRAN -->
<!-- always evaluate -->
<p><img src="data:image/png;base64,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" width="480" /></p>
<p>Based on this data, we’ll attempt to re-construct the original
image.</p>
<p>As model, it is assumed that the original image
<code>image(volcano)</code> is a realization of a random field with
correlation decaying exponentially with distance between pixels.</p>
<p>Denoting by <span class="math inline">\(u(x,y)\)</span> this random
field the model for the observations is</p>
<p><span class="math display">\[ z_{i} = \mu + u(x_i,y_i) +
\varepsilon_i \]</span></p>
<p>To fit the model, a <code>numFactor</code> and a dummy grouping
variable must be added to the dataset:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>pos <span class="ot">&lt;-</span> <span class="fu">numFactor</span>(d<span class="sc">$</span>x, d<span class="sc">$</span>y)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(d)))</span></code></pre></div>
<p>The model is fit by</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(z <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(pos <span class="sc">+</span> <span class="dv">0</span> <span class="sc">|</span> group), <span class="at">data=</span>d)</span></code></pre></div>
<p>Recall that a standard deviation <code>sd=15</code> was used to
distort the image. A confidence interval for this parameter is</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(f, <span class="st">&quot;sigma&quot;</span>)</span></code></pre></div>
<pre><code>##          2.5 %   97.5 % Estimate
## sigma 10.61016 18.06028 13.84278</code></pre>
<p>The glmmTMB <code>predict</code> method can predict unseen levels of
the random effects. For instance to predict a 3-by-3 corner of the image
one could construct the new data:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">pos=</span><span class="fu">numFactor</span>(<span class="fu">expand.grid</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="at">y=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)) )</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>newdata<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(newdata)))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>newdata</span></code></pre></div>
<pre><code>##     pos group
## 1 (1,1)     1
## 2 (2,1)     1
## 3 (3,1)     1
## 4 (1,2)     1
## 5 (2,2)     1
## 6 (3,2)     1
## 7 (1,3)     1
## 8 (2,3)     1
## 9 (3,3)     1</code></pre>
<p>and predict using</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(f, newdata, <span class="at">type=</span><span class="st">&quot;response&quot;</span>, <span class="at">allow.new.levels=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 114.3405 115.2834 116.2061 114.6033 115.6916 116.7725 114.7828 116.0382
## [9] 117.3101</code></pre>
<p>A specific image column can thus be predicted using the function</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>predict_col <span class="ot">&lt;-</span> <span class="cf">function</span>(i) {</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    newdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">pos =</span> <span class="fu">numFactor</span>(<span class="fu">expand.grid</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">87</span>,i)))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    newdata<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(newdata)))</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(f, <span class="at">newdata=</span>newdata, <span class="at">type=</span><span class="st">&quot;response&quot;</span>, <span class="at">allow.new.levels=</span><span class="cn">TRUE</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Prediction of the entire image is carried out by (this takes a
while…):</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">61</span>, predict_col)</span></code></pre></div>
<p>Finally plot the re-constructed image by</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(pred, <span class="at">main=</span><span class="st">&quot;Reconstruction&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAHgCAIAAADytinCAAAgAElEQVR4nO3de3BV1fn/8XVyDiExCcmBhIsQJUFAgyKIBgj4DSpX/QphkCJCbb3QOqQ6olWZsWWqHanTTsVeNDptmUalzlSxBrwQi3IRuQi/QUDSFKuYgARjYhITjCEJ+/fHmS9uNmZ3s8++PDt5v/5KTpK91skJH5dnPevZIU3TFABAngS/JwAA+G4ENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENFw0fPjwkE5CQkJ2dvYTTzzh97yUUqqxsbG+vr6jo8Ola544cSIUCiUnJzt4ffQ0BDRcl5OTM2bMmMsvv3zQoEFHjx69//77t2zZ4vek1DXXXJOZmblv3z6XrpmQkDBmzJjRo0c7eH30NAQ0XLdq1aq9e/d+8MEHR44cufjii5VSb7/9tt+Tcl1ycvLevXt37drl90QQYAQ0vJOQkDBp0iSlVOx//D/99NOioqKsrKwBAwb88Ic/bGpqin1bY2PjkiVLhg4dmpGRMW3atL1798Yeb21tffDBB0eOHJmWlnbVVVf97W9/iz3++eefh0KhrKysV1999dJLL+3Tp8/s2bNra2tjX92+fXthYWGfPn369+8/Z86cgwcPKqXGjh37wQcfKKWuvPLKtWvXnr7Cjh07Yo8cPHgwFApdcsklsYu89957oVBo4sSJJjM0XNPwFoe9yaOn0wDXXHTRRUqpV199Nfbp559/HltBv/fee1999dXAgQN79eo1d+7cyZMnK6VmzZrV2dl56tSpCRMmKKVGjx49efLkUCiUmZn5+eefa5o2c+ZMpVR2dvYNN9xw3nnnKaVKSko0TTt+/LhSKhKJ9O7de8yYMZFIRCl15513apr2xRdf9OnTJyEhYe7cuddcc41S6vzzz29tbd2wYcOFF16olHrssceOHDkSu0Jqamp2drZS6uWXX/7www+VUhdffHFs5tu2bVNKTZgwQdO0rmZouGZLS4tSKikpKXYFG5MHCGi4KBbQepFI5K9//aumabGtwrvvvjv2nQUFBUqp9evXb9y4USk1fPjwjo4OTdNuueWWSCTyl7/85d13340FXFNTk6ZpZWVlSqmsrCzt/zIulvuapj3//POx9NQ0bfPmzUqpYcOGHT58WNO0X/7yl3fddVd1dbWmaWPGjFFK7dmzR3+F5cuX19TUtLe3mwR0VzM0XFMf0PYmD/AWB1wX2yQcPXp0YmJiR0dHbEG9f/9+pdQf/vCHWIHH9u3blVIHDx6MJePkyZPD4bBSas2aNe3t7bfffnts5+3GG2/s06ePUmrmzJkpKSlffPFFTU1NbJRoNBpL+SuvvFIp9fXXXyul8vPzs7KyPv7445ycnLy8vPr6+p/+9KexZfLZevfu/bOf/WzgwIGxZWxXupqhyY/Ymzxg9ocIOGLVqlVz5sxRStXU1FxwwQWvvvrqxx9/HAvB4uLiq6+++vR3jhw5MrZ/2LdvX8NFNE1TSoVCodiniYmJ6enpJ06c6OjoSExMVErF4lL/PUqp5OTkysrKl156ad26de+8886TTz5ZUlKyZ8+eSy+99Ox5pqWlpaSknD2oQayK7uwZmrA3eYAVNLwzaNCgwYMHK6VqampGjRqllEpJSVmwYMGCBQuampr27NkTCoXy8vKUUhs3bozl4A9+8IO0tLQXXnjh8ssvV0qtX78+9tbB5s2bjx071q9fv66WwzEbNmz4zW9+c+GFF77++ut1dXXTpk1ra2vbunXr6W/oqg46KSlJKfXpp59+9dVXSil9XWBXMzS5pr3JA7wHDRcZNgk1TRs6dKhSasOGDU1NTVlZWQkJCYsWLZo9e7ZSatiwYS0tLZ2dnbF3ci+//PIpU6aEQqFBgwbV1dVpmjZt2jSlVE5OTlFRUWyp+9RTT2n/9zZuZmZmbIjKykql1EUXXaRp2htvvKGUSk1NnTt37vz585OTk3v16nXgwAFN02KL+uuvv37//v2GK2ia1t7enpWVpZTq37//ZZddFsvr2HvQJjPUX9OwSWhj8gABDRedHdDXXnutUuonP/mJpmmHDh2aNWtWNBodMGDArbfe+tlnn8W+p7a29tZbbx08eHB6evqsWbMOHjwYe/zEiRP33Xff8OHDU1NTx40b9/zzz8ceN8+4559//sorr0xPT09NTc3Pz3/99ddjj2/evHncuHGpqalvvvnm2QGtadrbb789atSo1NTUwsLC2N5dLKBNZqi/piGg7U0ePVxI+6532QAAvuM9aAAQioAGAKEIaAAQioAGAKEIaAAQioAGAKEIaAAQioAGAKEIaAAQioAGAKEIaAAQioAGAKEIaAAQioAGAKEIaAAQioAGAKEIaAAQyuuAbm5u5h4uAGCFFwHd2tq6cuXKkSNHJiUl9enTJzExccSIEY8++ujJkyc9GB0AAsqLgC4uLt69e/fq1atramra29tra2tLS0srKiqWLl3qwegAEFBe3DQ2Kyururo6OTlZ/2BnZ2dubm5VVZXbowNAQHmxgs7Ozi4vLzc8uHXr1szMTA9GB4CA8mIFvWvXrvnz52dkZOTl5aWlpbW0tFRWVtbV1ZWVlV1xxRXndKm6urpNmza5NE8AOFcJCQmzZ8/u1auXGxf3IqCVUp2dnZs2baqqqqqvr49Go8OGDSssLAyHw+d6nb///e/Tx9Yn9Y64Mckg6qz/yMZPabXvOz4TX4T65/s9BaWUCvcb7vcUnBFJH+Lb2CkZvg2td6LxXH9i7/7Dfc+fMWzYMDem41HShcPhqVOn6h9pbGzctWvXjBkzzvVSSb0jkXMO9m4rlGDnv69aQqfjM/GFvafvuHNfaQgViYT8G1vGmYxz/w1kZPRxYyIxvi1FKyoqioqKWltbu/qGnTt3btmyxfDgjh07bhx/vVL+/RkBgFd8C+iCggKTdFZKDRkyZNy4cYYH33//fU3TCGgAPYHcN3OHDBkyZIjxHbHXX3/dl8kAgPdkvO8DADiLFyvoY8eONTc3f+eXRo4c6cEE5OisOxTnFcKZI2z8lFa7M85xZbL+vEL9J7g3DcPLau816nFSon7PQCml1IkGv2dgxouAfvnllx9++OFvvvnm7JMpNTU1HkwAAILIi4C+55578vLyli1bduDAAQ+GA4DuwaP3oKdMmTJ27FhvxgKA7sGjgI5EIs8995w3YwFA9yC3zC5A4t/6c2QsezuBp2q2xTGd75AwaLKzF3SEyS/H8f1D/WvEhqFEsjcG9SizAwChCGgAEIqABgChCGgAEIqABgChqOKwycvKjfgPajteqmFvLPkFHq5WdFhH7YfDglO2YcAKGgCEIqABQCgCGgCEIqABQCgCGgCEoorDKsfLNhxvom+vVKPziNXvDGfbuPwZ7M3Qy9oPL1t2mDD5Y6PAw6rAVm7osYIGAKEIaAAQioAGAKEIaAAQioAGAKGo4jATf+WGI6Ua8XfSsF6qEf9F4i/2MBDS3IMCDwekRF28eLco2zBgBQ0AQhHQACAUAQ0AQhHQACAUm4TOs7cx6NdOYPsnXX6pV67D02D/0FXB3j/Ed2EFDQBCEdAAIBQBDQBCEdAAIBQBDQBCdasqDsd76pvoNqUa9n7KkQIPx4s69Kz/ql2t9zD8nbha1NETSzW64/FuPVbQACAUAQ0AQhHQACAUAQ0AQhHQACBU8Ko4Ous/6oyEvB/Xy7INL0s17DGMJb9rhwkvG3ro/4q8bNMhhb7owl7z/u5etmHAChoAhCKgAUAoAhoAhCKgAUCo4G0SesnVjUH5O4HW6Wdlb8PQQP7+oZ69vUQvT4FLJGO7r6Oxyz+1SIaHf2pdYAUNAEIR0AAgFAENAEIR0AAgFAENAEL1xCoOe7UZBq6e4bZXqtHi9O0KUm31f3e8zb+BkAIPPS8Pi6NHYQUNAEIR0AAgFAENAEIR0AAgFAENAEL5U8VRX1/fr18/L0eMv3LDetmGq002HC/VsD6WvaIOPUfa/JvQ/+b9qugwMPzZOF7UEc6M+1Xp2SQ03DDhxQq6trb29ttvz8/PX758eV1d3RVXXNG/f/+RI0dWVlZ6MDoABJQXAX3nnXc2Nzc/9NBDFRUVeXl5CxYsaGxsXLRo0d133+3B6AAQUF68xbFly5bq6ur09PT8/PwRI0YsW7YsMTHx/vvvf/LJJz0YHQACyosV9IABA959912l1JYtW7755ptPPvlEKXXo0KFo1NZdIwGgZ/BiBf3rX//6e9/7Xnp6uqZpTz311NSpU6dPn/7aa6/94he/cHYgL3cC9dxuvW9xY7D6mJ1pXHC+nWnEv2GoXGjzr2d4UYTsGZqQcMNvQ/d64RtoPYEXAV1UVHTkyJH//Oc/l156aUpKyujRozdu3PjCCy9Mnz7dg9EBIKA8KrPr16/f6bq6yZMnT548ubGxsby8fMaMGV39yIkTJz7//HPDg01NTUr1dXGiACCGb93sKioqioqKWltbu/qGd9999x//+IfhwT179mjaNKVCLs8OAPznW0AXFBSYpLNSaubMmTNnzjQ8uGzZslCIdAbQI3h91Lu5uVnTNI8HBYAg8mIF3draumrVqtLS0qqqqra2tkgkkpOTs3jx4uXLlycmJsZ5ceGVG0JKNaxf0GJRh8lsHWnz73ZRh578Ag8TnXXfvhIc++5+vFhBFxcX7969e/Xq1TU1Ne3t7bW1taWlpRUVFUuXLvVgdAAIKC9W0OvXr6+urk5OTo59Go1GJ06cmJ+fn5vr9DIJALoRL1bQ2dnZ5eXlhge3bt2amZnpwegAEFBerKBLSkrmz5+/YsWKvLy8tLS0lpaWysrKurq6srIyD0YHgIDyIqDHjx9/+PDhTZs2VVVV1dfXR6PRJUuWFBYWhsNhD0YHgIDyqA46HA5PnTrVkUtpte9rkbgK9QLXet9i5cbhz6yWxOQMPmllLOttOvQcafPvapsOA4Ft/oXQt+agL4dK6aK5W1Kbe2NyyysAEIqABgChCGgAEIqABgChfGuW5DGLG4OBa71vfWOwq5+yuGFo4GWbf7dPgcOKntLLv6udQJ+wggYAoQhoABCKgAYAoQhoABCKgAYAobpzFYe9TvwWyT/P/VHbhac/Ht67ysYFrRd42GvzL/AUuKGMJ1gnv/XN+5XL/fsNRR163bbAww+soAFAKAIaAIQioAFAKAIaAIQioAFAqO5cxWGRxf4b8htu6Ms2zL9kUtRhMq7jbf7jb9PRXWm1O/WfhvpP8GsmNgSszb+w5hsGrKABQCgCGgCEIqABQCgCGgCEIqABQKhuVcXhavMNE0IablhnsU2Hgb37sLjapsPtm63oK3wc6cuh/xNNGDTZgSt2Td+aw9W+HCZ6yn1YXMMKGgCEIqABQCgCGgCEIqABQKhutUlokcWz3epcjnd3xfHz3I6zdwrcOnunwAXysZe//uS3vWPfhl7+XXF7LzFgp8AFYAUNAEIR0AAgFAENAEIR0AAgFAENAEL1xCoOR1g/3u0se2e77V3fpKLDei9/e+z18tdX3Th+7Ntxhs4Ebp/8tsKk2MPxAg8pp8BPNJzxqbD+/aygAUAoAhoAhCKgAUAoAhoAhCKgAUAoqjjOEH/zDSWmK79A9nr5y+RXL399Xw5ltzWHDW4XeNCm4zuxggYAoQhoABCKgAYAoQhoABAq8JuEFu/kbb1Jf1ccOdvtV1f+QJN5w289k78ue/uH1k+BG/YM9fzaP/TrDuLdEitoABCKgAYAoQhoABCKgAYAoQhoABDKhyqOhoaGSCSSlpbm/dAusXi227rAne3WV6c43rw/0AwFHvEXdVjv629S4GGRvToQfVEHFR1x8mIFXVVVtXjx4iNHjlRVVRUUFPTr1y8jI+Paa689evSoB6MDQEB5EdALFy4cNmzYoEGD7rnnnsmTJ3/22WdHjx696qqr7rrrLg9GB4CA8uItjsrKys2bN0cikf37969ZsyY1NVUp9atf/WrAgAEejA4AAeXFCnrChAlr165VShUUFLz11luxB996660hQ4Z4MDoABJQXK+g//elPs2bN+u1vfztw4MB58+ZdccUVp06dqqmpWbdunQejA0BAeRHQgwcP3rdv35YtWz766KP/+Z//SU9PHzp06HXXXReJiOgEYtKkP/7+GzTfMKGvfrHevF//oljsy6HOfJVd7cthLv6uHRabz6hzqffoSvyNPmjTESePIjIUCk2ZMmXKlCmnH2lsbNy1a9eMGTO8mQAABI5va9iKioqioqLW1tauvmHt2rXPPPOM4cFDhw79YtoFLk8NAETwLaALCgpM0lkpNW/evHnz5hkeXLZsWSj0/5TS3JwaAIjg9VHv5uZmTSNeAeC/82IF3draumrVqtLS0qqqqra2tkgkkpOTs3jx4uXLlycmBnUPjePdesE63u1lL3/r3O763xV7e4n6/UPP7gzQA3mxgi4uLt69e/fq1atramra29tra2tLS0srKiqWLl3qwegAEFBerKDXr19fXV2dnJwc+zQajU6cODE/Pz83V8bSBQBE8mIFnZ2dXV5ebnhw69atmZmZHowOAAHlxQq6pKRk/vz5K1asyMvLS0tLa2lpqaysrKurKysr82B0AAgoLwJ6/Pjxhw8f3rRpU1VVVX19fTQaXbJkSWFhYTgc9mB0AAgoj+qgw+Hw1KlTvRkLPYfhLL71k996Qk6BmzAp8NBzvNjDYoGH4UR4wIo6UqJ+z8AMt7wCAKEIaAAQioAGAKEIaAAQioAGAKFEtMzvZmjSb4Oht4n1/v3OMrl7g+McrxixWOxhYFL7oS/wsN6yw6RNh75/v6fN+2WXaphgBQ0AQhHQACAUAQ0AQhHQACAUAQ0AQlHF4ZtA30JFJn1rDnt9Obxkr2LEpPbD5IImP6Wv/bBY0aHs3ofFRCTDVicRE4Gt3NBjBQ0AQhHQACAUAQ0AQhHQACAUm4Tonhzp5S+Qva1Fx29KYO8UuImOxm83K21uGHaLXUEDVtAAIBQBDQBCEdAAIBQBDQBCEdAAIBRVHOgRDEUdeo4XeHg5lrMMLf9NTn7DG6ygAUAoAhoAhCKgAUAoAhoAhCKgAUAoqjg8Jb9J//DeVTZ+6vBniac/zhl8Mv5pVB/79uMLzo//emZMii68HEt4gYcJk17+Wu1O/ZdC/SdYuaC+L4dyo5d/cLCCBgChCGgAEIqABgChCGgAECrwm4T6HQnDZgW6B/2GoXJ/z9AvAm9JbvGG3zYvXnfGhmk4M+7nfKLhjE+7Rf9+VtAAIBQBDQBCEdAAIBQBDQBCEdAAIFTgqzgs0u9BG7qS6+9Cb7invX4z3csDwTDh5Slwvxj+2IQUdfhFf/L7HI5964s6AlvRwQoaAIQioAFAKAIaAIQioAFAKAIaAITqKVUcjtPXDxiaRfRAjjTpt6GHtOnoCfStORzoy2FgaNOhZ1LgIaC5BytoABCKgAYAoQhoABCKgAYAofzZJNyxY8fEiRMdv6y+eb+ifz8Cq7ue7dbf5NviHb4NnL/ht8lOoIAD4v6soKdPn+7LuAAQIF4E9L333pt8ppaWltgHHowOAAHlxVscK1eubG1tPXjwYElJSf/+/ZVSubm5n3zyyX/9QQDoybxYQZ933nnPPvvsgw8+eMstt+zZs2fAgAEJCQkDBgwYMGCAB6MDQEB5t0k4e/bs/Pz82267bf369Z4NCgDB5WkVx8CBA994442nn366qKjI9kVC/fNDkdDpT/X7wgb6og59RYfhBvL6/v365v3qrP79FunPPR/+LFH/peG9q05//FHbhXau7jT9lACI4nUVRygUKi4ufv755xsbG8vLyz0eHQACxLdmSRUVFUVFRa2trV19w4EDB3bs2HH2g0qNcXlqACCCbwFdUFBgks5Kqd69e0ejxkLxpKQkNycFAIJ4HdDNzc2pqamhUOi/fueIESNGjDAeqNq+fbs78wIAcbx4D7q1tXXlypUjR45MSkrq06dPYmLiiBEjHn300ZMn/WkiDACB4MUKuri4uKGhYfXq1Xl5eWlpac3NzZWVlb/73e+WLl365z//2YMJOMLQHqHl2/bixj7x8vv3x1+54VeHfoPu1KHf1f4bhvIkfEtAww0TXgT0+vXrq6urTx/sjkajEydOzM/Pz83lrwYAuuTFWxzZ2dlnV9Rt3bo1MzPTg9EBIKC8WEGXlJTMnz9/xYoVsbc4WlpaKisr6+rqysrKPBgdAALKi4AeP3784cOHN23aVFVVVV9fH41GlyxZUlhYGA6HPRgdAALKozK7cDg8depUb8YCgO7Bt4MqTtHfl8FGXw51ZmuOzjNu13DG3nf8fTnUma05TEophLTpMKByI37BulVKOO7bldjTWXdI/2k4M1C/NUdxT0IAEIqABgChCGgAEIqABgChAr9JqGe4kbvJnmH89Ls9LWdsaZyxi2U49m3Sy1/PsH8Y/56hvbPdbu8KBnq7T0/m1h/Hu7sk+3i3HitoABCKgAYAoQhoABCKgAYAoQhoABAqeFUc4X7Dw72+/e+K4VSoXlenwPXHvtWZJ78NZ1v1J78Ne+L6k9/2evmbnAI3iL+/vnXxV27Ir82QWXQhgV9nu9EVVtAAIBQBDQBCEdAAIBQBDQBCEdAAIFTwqjgM9M28bVR0KLu9/O2x2KbDwKTAwx5KNbqlYDXfMPwzNDTScVhwmm8YsIIGAKEIaAAQioAGAKEIaAAQKvCbhHqGu/92tWfoSF9/kxt+m/Ty1zM5BW7A7bQt6oEbg/EL9PHujsZv9+4jGUF+Jl1gBQ0AQhHQACAUAQ0AQhHQACAUAQ0AQnWrKg4Di6fA9bzs5W9gcgrcS/GXarhdSqH/HToylklBDmzQ/6sx/IOyR/+P11CpZdWJhjM+Dc7Jb1bQACAUAQ0AQhHQACAUAQ0AQhHQACBU8Ko4IulDIonh7/yS/mC+gUlFh0kvf3scb9NhkUnth+NtNHzsemFvaIvN7E0KcmCD4Q4YJkUd+n967jbvDxRW0AAgFAENAEIR0AAgFAENAEIFb5PQhKFjt8meoUXx3/Db+ilwPZP9QxNuN9SPf2PQ+m2nLe7OybyPdfyzYnPSBsO/d7P+/fqT37KPfbOCBgChCGgAEIqABgChCGgAEIqABgChulUVh4F+Gzf+ig4TJr38DSz2hne8wMM6Vw9S+3hBe/yaRnc9cR5/L39Dnwab/fuDgxU0AAhFQAOAUAQ0AAhFQAOAUAQ0AAjlXRVHY2NjRkaG/pGmpqb09HTPJhAnw6azoTWHDfZ26n3slK8npMqih7BY/AM9feGW1b4cSlxrDi9W0AcOHBg1alTfvn2HDRtWVlYWe7Ctrc2Q1wAAPS9W0HfdddcNN9ywffv2vXv3Lly4MDMzc9KkSR6MCwCB5kVAf/jhh+Xl5ampqVOmTHn22WeXLFmyb98+D8YFgEDz4i2OoUOH7tixI/bx7NmzR48evWzZMg/GBYBA8yKgH3/88blz586YMePLL79USj3zzDO7d+/mXQ4AMOfFWxyzZs2qrKzctm1b7969lVIZGRnbtm0rKyvbs2ePq+O62n/DhMWbrRiY1EUI2bi3WLkR7nrDHBZZv0ePDT6+QBb7b2i1O/WfhvpP6Oo79a05umVfDo/K7IYMGXLzzTef/rRXr15Tp05NS0vzZnQACCLfutlVVFQUFRW1trZ29Q1r16595plnDA8eOnTo8Z9f5/LUAEAE3wK6oKDAJJ2VUvPmzZs3b57hwWXLloVCITfnBQBSeH3Uu7m5WdM0jwcFgCDyYgXd2tq6atWq0tLSqqqqtra2SCSSk5OzePHi5cuXJyYmOjiQX7uCJkw2ZBzZP9RzfC/R+n4UG4POsn4LCHsX7GkMyWD15LeAY99erKCLi4t37969evXqmpqa9vb22tra0tLSioqKpUuXejA6AASUFyvo9evXV1dXJycnxz6NRqMTJ07Mz8/PzaXjDgB0yYsVdHZ2dnl5ueHBrVu3ZmZmejA6AASUFyvokpKS+fPnr1ixIi8vLy0traWlpbKysq6u7nRnOwDA2bwI6PHjxx8+fHjTpk1VVVX19fXRaHTJkiWFhYXhcNiD0QEgoDyqgw6Hw1OnTnXkUh1NRxN6nfM7M4a7tcdPf2jVXvN+Rwo89KwXXZjUe7h6ntviSV+D+O+NYHtox6dhT3BrMOL/tftJQC9/bnkFAEIR0AAgFAENAEIR0AAgFAENAEL51s3OAxYrNwzdwSWwvmvvdr2HDY5v3AupBHB7Gj5WicRJyAtk+Pdu0r9f35rDrC+HgR9tOlhBA4BQBDQACEVAA4BQBDQACNWtNgn92hU02SRxe+fH8fPi9sYSsk0UaBZ/h47/RfHaScYKGgCEIqABQCgCGgCEIqABQCgCGgCECnwVh/Dz3D6eD46/wCO4feLPFuo/wbOxXP1jo+hCBP2x72+a1XlujcMKGgCEIqABQCgCGgCEIqABQCgCGgCECnwVRw9nrw1I/OUZ1msJTMonXK128LJsw97QAu8UIYSPr500rKABQCgCGgCEIqABQCgCGgCECt4mYWf9R52RkN+z8I1h/8Rkoyn+2wjYO1VsfYcn/v3DQO8mWZ+8hO1E6394jlzfBpPbeAcXK2gAEIqABgChCGgAEIqABgChCGgAECp4VRz26PeIJeyJn83eLra95xV/03e3yyf8Ks+wVwlg8a4RtgksVhEypW5ZuaHHChoAhCKgAUAoAhoAhCKgAUAoAhoAhOopVRx6bncVsD60qxcX0i3BZJ/d7eIHi+KvBJD/HAOt25dqmGAFDQBCEdAAIBQBDQBCEdAAIFRP3CQ0EHJo1XHBOi3tJS9naBirJ+wZyv8DCBBW0AAgFAENAEIR0AAgFAENAEIR0AAglNdVHM3NzampqaFQyONx4Sp7G/f6n+oJ5Q0qyIfCu1NtRiQj2+8pWDdA5l0AAAf+SURBVOXFCrq1tXXlypUjR45MSkrq06dPYmLiiBEjHn300ZMnT3owOgAElBcBXVxcvHv37tWrV9fU1LS3t9fW1paWllZUVCxdutSD0QEgoLx4i2P9+vXV1dXJycmxT6PR6MSJE/Pz83Nzcz0YHQACyosVdHZ2dnl5ueHBrVu3ZmZmejA6AASUFyvokpKS+fPnr1ixIi8vLy0traWlpbKysq6urqyszIPRASCgvAjo8ePHHz58eNOmTVVVVfX19dFodMmSJYWFheFw2IPREQiO96wIXNWBxQk7XuwRuF9Uj+JRmV04HJ46dar+kcbGxl27ds2YMcObCQBA4PjWza6ioqKoqKi1tbWrb1i3bt0LL7xgeHDfvn2PLPpfpSijBtD9+RbQBQUFJumslJo5c+bVV19tePCVV14Jh/+tlObm1ABABLknCRMTExMTEw0PpqWluTMvABDHi4BubW1dtWpVaWlpVVVVW1tbJBLJyclZvHjx8uXLz45gc+np6S9uOJyaknz8+PFIpPvfbaCjoyMQTzMhpTaeH+/o6AiHw/r/bJ868YW/U3LDqVOnlFIJCXHVtsb/mzFw/BelaVpnZ6fkv9uE5Kgj1zl16tTAgQMPVhy+465rHbngd9Dcd9tttxUVFW3btu3LL79sb2//8ssvt2/fvmDBgjvuuMPeBY8fP75gwQJnJynTlClT/J6CF3784x9XVlb6PQvXrVmz5tlnn/V7Fq47evTookWL/J6FFzz458lJQgAQipOEACAUJwkBQChOEgKAUL6dJAQAmAvkLa8SEhLirFUKCsm1Sg7qIS9oOBzuCf/X2ENeTeXJP8+QpgXyVF5zc3NPOLTSQ55mS0tLamqq37Nw3cmTJzVN6927t98TcV0P+bv14GkGNaABoNvrEf8nAgBBREADgFAENAAIRUADgFAENAAIRUADgFAENAAIFYCAfv/998eNG5eVlXXHHXecfZcs868GiPkTefPNN8eMGZOenj558uQPP/zQlxk6wsrr9fXXX997770eT8xx5s/02LFj119/fd++fSdNmlRVVeXLDB1h/jTLyspGjhyZkZExZ86c2lpxt1A4V7///e+PHTt29uMuppDbDafj1NHRkZ2d/corr3z99ddz5sx57LHHrH81QMyfyJEjR1JSUsrLy5ubmx944IG8vDy/5hkni6/Xj370o6SkJI/n5izzZ3rq1KnLLrtszZo1bW1tP//5z4Pb3t78adbV1SUnJ69bt66hoeGmm2667bbb/Jpn/Nrb2zdu3Jiamnr2nSVcTSHpAf3Pf/7zsssui328bdu2ESNGWP9qgJg/kRdffHH69OmxjxsbG0OhUENDg9dTdIKV16usrGzSpElBD2jzZ7pp06Zx48bFPm5vb6+urvZ6fg4xf5o7d+4cOHBg7OOXX375qquu8np+zvn+979/6aWXRiKRswPa1RSS/hZHVVVVXl5e7OO8vDzD/wyafzVAzJ/IjTfe+OKLL8Y+3rt3b05OTkZGhtdTdMJ/fb2OHz/+8MMPl5SUeD41h5k/048++mjQoEGLFi3Kzc296aabtMC2WzB/mqNGjdI0bc2aNUePHi0tLb32Wtdu3Oe+55577sCBA995jxFXU0h6QNfX159uR5KWltbW1tbc3GzxqwFi/kRSUlL69u2rlFq3bt3ChQufeOIJf2YZN/OnqWnabbfd9vjjj/fv39+nCTrG/Jk2NDS89tprc+fO3bdv34gRI26++Wafphkv86eZmpq6YsWKxYsXDx8+fOfOnQ888IBP03SXqykkPaCj0WhLS0vs4+bm5kgkom97Zv7VAPmvT6SpqWnhwoUPPfTQyy+/PGfOHD/m6ADzp/n0009feOGFN9xwg0+zc5L5M01PTx87duxNN92Ulpa2bNmynTt3NjQ0+DTTuJg/zW3btj322GMVFRVNTU333XfftGnTfJqmu1xNIekBnZub++9//zv2cWVlZU5OTigUsvjVADF/Iu3t7TNmzOjbt+/+/fsnTZrk0xwdYP40d+7cuWbNmrS0tNzc3G+++SYtLW3Hjh0+zTRe5s906NCh+rc1QqFQQBt/mz/NjRs3Tp8+/ZJLLklMTCwuLt63b199fb1PM3WRuynk4PvZbujo6Bg8ePA777zT0dGxYMGCRx55JPb4e++919DQ0NVXA8f8ab700kvjxo37Rsff2dpm/jRPf9vx48eDvklo/kxPnjw5YMCADRs2dHZ2PvTQQ9dcc42/s7XN/Glu2LAhKytr7969J06ceOSRR4K7h3/awIED9ZuEHqSQ9IDWNG3Pnj1jx4694IILbr/99ra2ttiDSUlJGzZs6OqrQWTyNJcvX274z2pjY6O/s7XN/NWM6QYBrf23Z7pz584xY8ZkZmZef/31R44c8XWmcTF/mn/84x9zc3MzMjKuu+66f/3rX77O1AGGgPYghWjYDwBCSX8PGgB6LAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAKAIaAIQioAFAqP8Pl1vS4lY2V7kAAAAASUVORK5CYII=" width="480" /></p>
</div>
</div>
<div id="mappings" class="section level2">
<h2>Mappings</h2>
<p>For various advanced purposes, such as computing likelihood profiles,
it is useful to know the details of the parameterization of the models -
the scale on which the parameters are defined (e.g. standard deviation,
variance, or log-standard deviation for variance parameters) and their
order.</p>
<div id="unstructured" class="section level3">
<h3>Unstructured</h3>
<p>For an unstructured matrix of size <code>n</code>, parameters
<code>1:n</code> represent the log-standard deviations while the
remaining <code>n(n-1)/2</code>
(i.e. <code>(n+1):(n:(n*(n+1)/2))</code>) are the elements of the
<em>scaled</em> Cholesky factor of the correlation matrix, filled in
row-wise order (see <a href="http://kaskr.github.io/adcomp/classdensity_1_1UNSTRUCTURED__CORR__t.html">TMB
documentation</a>). In particular, if <span class="math inline">\(L\)</span> is the lower-triangular matrix with 1
on the diagonal and the correlation parameters in the lower triangle,
then the correlation matrix is defined as <span class="math inline">\(\Sigma = D^{-1/2} L L^\top D^{-1/2}\)</span>,
where <span class="math inline">\(D = \textrm{diag}(L L^\top)\)</span>.
For a single correlation parameter <span class="math inline">\(\theta_0\)</span>, this works out to <span class="math inline">\(\rho = \theta_0/\sqrt{1+\theta_0^2}\)</span>.</p>
<p>(See calculations <a href="https://github.com/glmmTMB/glmmTMB/blob/master/misc/glmmTMB_corcalcs.ipynb">here</a>.)</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>vv0 <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(fit.us)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>vv1 <span class="ot">&lt;-</span> vv0<span class="sc">$</span>cond<span class="sc">$</span>group          <span class="do">## extract &#39;naked&#39; V-C matrix</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(vv1)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>rpars <span class="ot">&lt;-</span> <span class="fu">getME</span>(fit.us,<span class="st">&quot;theta&quot;</span>) <span class="do">## extract V-C parameters</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="do">## first n parameters are log-std devs:</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">unname</span>(<span class="fu">diag</span>(vv1)),<span class="fu">exp</span>(rpars[<span class="dv">1</span><span class="sc">:</span>n])<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="do">## now try correlation parameters:</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>cpars <span class="ot">&lt;-</span> rpars[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>n)]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(cpars)<span class="sc">==</span>n<span class="sc">*</span>(n<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">2</span>      <span class="do">## the expected number</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="fu">diag</span>(n)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>cc[<span class="fu">upper.tri</span>(cc)] <span class="ot">&lt;-</span> cpars</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(cc)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">diag</span>(L)))</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(D <span class="sc">%*%</span> L <span class="sc">%*%</span> D,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##       [,1]  [,2]  [,3]  [,4]  [,5]  [,6]
## [1,] 1.000 0.403 0.260 0.194 0.108 0.031
## [2,] 0.403 1.000 0.340 0.266 0.167 0.096
## [3,] 0.260 0.340 1.000 0.399 0.254 0.194
## [4,] 0.194 0.266 0.399 1.000 0.342 0.268
## [5,] 0.108 0.167 0.254 0.342 1.000 0.358
## [6,] 0.031 0.096 0.194 0.268 0.358 1.000</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">unname</span>(<span class="fu">attr</span>(vv1,<span class="st">&quot;correlation&quot;</span>)),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##       [,1]  [,2]  [,3]  [,4]  [,5]  [,6]
## [1,] 1.000 0.403 0.260 0.194 0.108 0.031
## [2,] 0.403 1.000 0.340 0.266 0.167 0.096
## [3,] 0.260 0.340 1.000 0.399 0.254 0.194
## [4,] 0.194 0.266 0.399 1.000 0.342 0.268
## [5,] 0.108 0.167 0.254 0.342 1.000 0.358
## [6,] 0.031 0.096 0.194 0.268 0.358 1.000</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">c</span>(<span class="fu">cov2cor</span>(vv1)),<span class="fu">c</span>(fit.us<span class="sc">$</span>obj<span class="sc">$</span>env<span class="sc">$</span><span class="fu">report</span>(fit.us<span class="sc">$</span>fit<span class="sc">$</span>parfull)<span class="sc">$</span>corr[[<span class="dv">1</span>]]))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Profiling (experimental/exploratory):</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="do">## want $par, not $parfull: do NOT include conditional modes/&#39;b&#39; parameters</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>ppar <span class="ot">&lt;-</span> fit.us<span class="sc">$</span>fit<span class="sc">$</span>par</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(ppar)</span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(<span class="fu">which</span>(<span class="fu">names</span>(ppar)<span class="sc">==</span><span class="st">&quot;theta&quot;</span>)) <span class="do">## the last n*(n+1)/2 parameters</span></span></code></pre></div>
<pre><code>## [1]  2 22</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="do">## only 1 fixed effect parameter</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>tt <span class="ot">&lt;-</span> <span class="fu">tmbprofile</span>(fit.us<span class="sc">$</span>obj,<span class="dv">2</span>,<span class="at">trace=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(tt)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tt)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="480" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>ppar <span class="ot">&lt;-</span> fit.cs<span class="sc">$</span>fit<span class="sc">$</span>par</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(ppar)</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(<span class="fu">which</span>(<span class="fu">names</span>(ppar)<span class="sc">==</span><span class="st">&quot;theta&quot;</span>)) <span class="do">## the last n*(n+1)/2 parameters</span></span></code></pre></div>
<pre><code>## [1] 2 8</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="do">## only 1 fixed effect parameter, 1 dispersion parameter</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>tt2 <span class="ot">&lt;-</span> <span class="fu">tmbprofile</span>(fit.cs<span class="sc">$</span>obj,<span class="dv">3</span>,<span class="at">trace=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tt2)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="480" /></p>
</div>
</div>
<div id="general-latent-variable-model" class="section level2">
<h2>General latent variable model</h2>
<p>Consider a generalized linear mixed model</p>
<p><span class="math display">\[\begin{equation}
g(\boldsymbol{\mu}) = \boldsymbol{X\beta} + \boldsymbol{Zb}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(g(.)\)</span> is the link function;
<span class="math inline">\(\boldsymbol{\beta}\)</span> is a
p-dimensional vector of regression coefficients related to the
covariates; <span class="math inline">\(\boldsymbol{X}\)</span> is an
<span class="math inline">\(n \times p\)</span> model matrix; and <span class="math inline">\(\boldsymbol{Z}\)</span> is the <span class="math inline">\(n\times q\)</span> model matrix for the <span class="math inline">\(q\)</span>-dimensional vector-valued random
effects variable <span class="math inline">\(\boldsymbol{U}\)</span>
which is multivariate normal with mean zero and a parameterized <span class="math inline">\(q \times q\)</span> variance-covariance matrix,
<span class="math inline">\(\boldsymbol{\Sigma}\)</span>, i.e., <span class="math inline">\(\boldsymbol{U} \sim N(\boldsymbol{0},
\boldsymbol{\Sigma})\)</span>.</p>
<p>A general latent variable model (GLVM) requires many fewer parameters
for the variance-covariance matrix, <span class="math inline">\(\boldsymbol{\Sigma}\)</span>. To a fit a GLVM we
add a <em>reduced-rank</em> (rr) covariance structure, so the model
becomes <!-- --> <span class="math display">\[\begin{align}
g(\boldsymbol{\mu}) &amp;= \boldsymbol{X\beta} + \boldsymbol{Z(I_n
\otimes \Lambda)b} \\
&amp;= \boldsymbol{X\beta} + \boldsymbol{Zb_{new}}
\end{align}\]</span> <!-- --> where <span class="math inline">\(\otimes\)</span> is the Kronecker product and
<span class="math inline">\(\boldsymbol{\Lambda} =
(\boldsymbol{\lambda_1}, \ldots, \boldsymbol{\lambda_d})&#39;\)</span>
is the <span class="math inline">\(q \times d\)</span> matrix of factor
loadings (with <span class="math inline">\(d \ll q\)</span>). The upper
triangular elements of <span class="math inline">\(\boldsymbol{\Lambda}\)</span> are set to be zero
to ensure parameter identifiability. Here we assume that the latent
variables follow a multivariate standard normal distribution, <span class="math inline">\(\boldsymbol{b} \sim N(\boldsymbol{0},
\boldsymbol{I})\)</span>.</p>
<p>For GLVMs it is important to select initial starting values for the
parameters because the observed likelihood may be multimodal, and
maximization algorithms can end up in local maxima. <span class="citation">Niku et al. (2019)</span> describe methods to enable
faster and more reliable fits of latent variable models by carefully
choosing starting values of the parameters.</p>
<p>A similar method has been implemented in <code>glmmTMB</code>. A
generalized linear model is fitted to the data to obtain initial
starting values for the fixed parameters in the model. Residuals from
the fitted GLM are calculated; Dunn-Smyth residuals are calculated for
common families while residuals from the <code>dev.resids()</code>
function are used otherwise. Initial starting values for the latent
variables and their loadings are obtained by fitting a reduced rank
model to the residuals.</p>
<div id="reduced-rank" class="section level3">
<h3>Reduced rank</h3>
<p>One of our main motivations for adding this variance-covariance
structure is to enable the analysis of multivariate abundance data, for
example to model the abundance of different taxa across multiple sites.
Typically an unstructured random effect is assumed to account for
correlation between taxa; however the number of parameters required
quickly becomes large with increasing numbers of taxa. A GLVM is a
flexible and more parsimonious way to account for correlation so that
one can fit a joint model across many taxa.</p>
<p>A GLVM can be fit by specifying a reduced rank (<code>rr</code>)
covariance structure. For example, the code for modeling the mean
abundance against taxa and to account for the correlation between taxa
using two latent variables is as follows</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(mvabund)) {</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data</span>(spider)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    <span class="do">## organize data into long format</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    sppTot <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">colSums</span>(spider<span class="sc">$</span>abund), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">cbind</span>(spider<span class="sc">$</span>abund, spider<span class="sc">$</span>x)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    tmp<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(tmp)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    spiderDat <span class="ot">&lt;-</span> <span class="fu">reshape</span>(tmp,</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">idvar =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">timevar =</span> <span class="st">&quot;Species&quot;</span>,</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">times =</span>  <span class="fu">colnames</span>(spider<span class="sc">$</span>abund),</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">varying =</span> <span class="fu">list</span>(<span class="fu">colnames</span>(spider<span class="sc">$</span>abund)),</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">v.names =</span> <span class="st">&quot;abund&quot;</span>,</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">direction =</span> <span class="st">&quot;long&quot;</span>)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>    <span class="do">## fit rank-reduced models with varying dimension</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>    fit_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">function</span>(d) {</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>                           fit.rr <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(abund <span class="sc">~</span> Species <span class="sc">+</span> <span class="fu">rr</span>(Species <span class="sc">+</span> <span class="dv">0</span><span class="sc">|</span>id, <span class="at">d =</span> d),</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> spiderDat)</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>                       })</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>    <span class="do">## compare fits via AIC</span></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>    aic_vec <span class="ot">&lt;-</span> <span class="fu">sapply</span>(fit_list, AIC)</span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>    aic_vec <span class="sc">-</span> <span class="fu">min</span>(aic_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The left hand side of the bar <code>taxa + 0</code> corresponds to a
factor loading matrix that accounts for the correlations among taxa. The
right hand side of the bar splits the above specification independently
among sites. The <code>d</code> is a non-negative integer (which
defaults to 2).</p>
<p>An option in <code>glmmTMBControl()</code> has been included to
initialize the starting values for the parameters based on the approach
mentioned above with the default set at
<code>glmmTMBControl(start_method = list(method = NULL, jitter.sd = 0)</code>:</p>
<ul>
<li><code>method = &quot;res&quot;</code> initializes starting values from the
results of fitting a GLM, and fitting a reduced rank model to the
residuals to obtain starting values for the fixed coefficients, the
latent variables and the factor loadings.</li>
<li><code>jitter.sd</code> adds variation to the starting values of
latent variables when <code>method = &quot;res&quot;</code> (default 0).</li>
</ul>
<p>For a reduced rank matrix of rank <code>d</code>, parameters
<code>1:d</code> represent the diagonal factor loadings while the
remaining <span class="math inline">\(nd-d(d-3)/2\)</span>,
(i.e. parameters <code>(d+1):(nd-d(d-1)/2</code>) are the lower diagonal
factor loadings filled in column-wise order. The factor loadings from a
model can be obtained by
<code>fit.rr$obj$env$report(fit.rr$fit$parfull)$fact_load[[1]]</code>.
An appropriate rank for the model can be determined by standard model
selection approaches such as information criteria (e.g. AIC or BIC)
<span class="citation">(Hui et al. 2015)</span>.</p>
</div>
</div>
<div id="construction-of-structured-covariance-matrices" class="section level2">
<h2>Construction of structured covariance matrices</h2>
<p>This section will explain how covariance matrices are constructed
“under the hood”, and in particular why the <code>0+</code> term is
generally required in models for temporal and spatial covariances.</p>
<p>Probably the key insight here is that the terms in a random effect
(the <code>f</code> formula in a random-effects term <code>(f|g)</code>
are expanded using the base-R machinery for regression model formulas.
In the case of an intercept-only random effect <code>(1|g)</code>, the
model matrix is a column of ones, so we have a <span class="math inline">\(1 \times 1\)</span> covariance matrix - a single
variance. For a random-slopes model <code>(x|g)</code> or
<code>(1+x|g)</code>, where <code>x</code> is a numeric variable, the
model matrix has two columns, a column of ones and column of observed
values of <code>x</code>, and the covariance matrix is <span class="math inline">\(2 \times 2\)</span> (intercept variance, slope
variance, intercept-slope covariance).</p>
<p>Things start to get weird when we have <code>(f|g)</code> (or
<code>(1+f|g)</code>) where <code>f</code> is a factor (representing a
categorical variable). R uses <em>treatment contrasts</em> by default;
if the observed values of <code>f</code> are
<code>c(&quot;c&quot;, &quot;s&quot;, &quot;v&quot;)</code><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> the corresponding factor will have a
baseline level of <code>&quot;c&quot;</code> by default, and the model matrix will
be:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(<span class="sc">~</span>f, <span class="fu">data.frame</span>(<span class="at">f=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;v&quot;</span>))))</span></code></pre></div>
<pre><code>##   (Intercept) fs fv
## 1           1  0  0
## 2           1  1  0
## 3           1  0  1
## attr(,&quot;assign&quot;)
## [1] 0 1 1
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$f
## [1] &quot;contr.treatment&quot;</code></pre>
<p>i.e., an intercept (which corresponds to the predicted mean value for
observations in group <code>c</code>) followed by dummy variables that
describe contrasts between the predicted mean values for <code>s</code>
and <code>c</code> (<code>fs</code>) and between <code>v</code> and
<code>c</code> (<code>fv</code>). The covariance matrix is <span class="math inline">\(3 \times 3\)</span> and looks like this:</p>
<p><span class="math display">\[
\newcommand{\ssub}[1]{\sigma^2_{\textrm{#1}}}
\newcommand{\csub}[2]{\sigma^2_{\textrm{#1}, \textrm{#2}}}
\left(
\begin{array}{ccc}
\ssub{c} &amp; \csub{c}{s-c} &amp; \csub{c}{v-c} \\
\csub{c}{s-c} &amp; \ssub{s-c} &amp; \csub{s-c}{v-c} \\
\csub{c}{v-c} &amp; \csub{s-c}{v-c} &amp; \ssub{v-c}
\end{array}
\right)
\]</span></p>
<p>This might be OK for some problems, but the parameters of the model
will often be more interpretable if we remove the intercept from the
formula:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>f, <span class="fu">data.frame</span>(<span class="at">f=</span><span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;v&quot;</span>))))</span></code></pre></div>
<pre><code>##   fc fs fv
## 1  1  0  0
## 2  0  1  0
## 3  0  0  1
## attr(,&quot;assign&quot;)
## [1] 1 1 1
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$f
## [1] &quot;contr.treatment&quot;</code></pre>
<p>The corresponding covariance matrix is</p>
<p><span class="math display">\[
\left(
\begin{array}{ccc}
\ssub{c} &amp; \csub{c}{s} &amp; \csub{c}{v} \\
\csub{c}{s} &amp; \ssub{s} &amp; \csub{s}{v} \\
\csub{c}{v} &amp; \csub{s}{v} &amp; \ssub{v}
\end{array}
\right)
\]</span></p>
<p>This is easier to understand (the elements are the variances of the
intercepts for each group, and the covariances between intercepts of
different groups). If we use an ‘unstructured’ model
(<code>us(f|g)</code>, or just plain <code>(f|g)</code>), then this
reparameterization won’t make any difference in the overall model fit.
However, if we use a structured covariance model, then the choice
matters: for example, the two models <code>diag(f|g)</code> and
<code>diag(0+f|g)</code> give rise to the covariance matrices</p>
<p><span class="math display">\[
\left(
\begin{array}{ccc}
\ssub{c} &amp; 0 &amp; 0 \\
0 &amp; \ssub{s-c} &amp; 0 \\
0 &amp; 0 &amp; \ssub{v-c}
\end{array}
\right)
\;\; \textrm{vs} \;\;
\left(
\begin{array}{ccc}
\ssub{c} &amp; 0 &amp; 0 \\
0 &amp; \ssub{s} &amp; 0 \\
0 &amp; 0 &amp; \ssub{v}
\end{array}
\right)
\]</span></p>
<p>which <em>cannot</em> be made equivalent by changing parameters.</p>
<p>What does this have to do with temporally/spatially structured
covariance matrices? In this case, if two points are separated by a
distance <span class="math inline">\(d_{ij}\)</span> (in space or time),
we typically want their correlation to be <span class="math inline">\(\sigma^2 \rho(d_{ij})\)</span>, where <span class="math inline">\(\rho()\)</span> is a temporal or spatial
autocorrelation function (e.g. in the AR1 model, <span class="math inline">\(\rho(d_{ij}) = \phi^{d_{ij}}\)</span>). So we want
to set up a covariance matrix</p>
<p><span class="math display">\[
\sigma^2
\left(
\begin{array}{cccc}
1            &amp; \rho(d_{12}) &amp; \rho(d_{13}) &amp; \ldots \\
\rho(d_{12}) &amp;     1        &amp; \rho(d_{23}) &amp; \ldots \\
\rho(d_{13}) &amp; \rho(d_{23}) &amp; 1            &amp; \ldots \\
\vdots       &amp; \vdots       &amp; \vdots       &amp; \ddots
\end{array}
\right)
\]</span></p>
<p>How <code>glmmTMB</code> actually does this internally is to</p>
<ul>
<li>treat the temporal/spatial locations as a factor to construct the
data structure for a <span class="math inline">\(n \times n\)</span>
covariance matrix (where <span class="math inline">\(n\)</span> is the
number of unique locations)</li>
<li>use the information encoded in the levels by
<code>numFactor()</code> to compute the corresponding pairwise
distances</li>
<li>use the prefix of the random term (e.g. <code>ar1</code> or
<code>ou</code>) and the autocorrelation parameters (drawn from the
parameter vector) to specify the autocorrelation function</li>
<li>use the autocorrelation function and the distances to fill in the
values in the correlation matrix</li>
<li>multiply the correlation matrix by the variance (also drawn from the
parameter vector) to compute the covariance matrix</li>
</ul>
<p>In order for this to work, we need the <span class="math inline">\(i^\textrm{th}\)</span> column of the corresponding
model matrix to correspond to an indicator variable for whether an
observation is at the <span class="math inline">\(i^\textrm{th}\)</span>
location — <em>not</em> to a contrast between the <span class="math inline">\(i\textrm{th}\)</span> level and the first level!
So, we want to use e.g. <code>ar1(0 + time|g)</code>, <em>not</em>
<code>ar1(time|g)</code> (which is equivalent to
<code>ar1(1+time|g)</code>).</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-hui2015model" class="csl-entry">
Hui, Francis KC, Sara Taskinen, Shirley Pledger, Scott D Foster, and
David I Warton. 2015. <span>“Model-Based Approaches to Unconstrained
Ordination.”</span> <em>Methods in Ecology and Evolution</em> 6 (4):
399–411. <a href="https://doi.org/10.1111/2041-210X.12236">https://doi.org/10.1111/2041-210X.12236</a>.
</div>
<div id="ref-niku2019gllvm" class="csl-entry">
Niku, Jenni, Francis K. C. Hui, Sara Taskinen, and David I. Warton.
2019. <span>“Gllvm: <span>Fast</span> Analysis of Multivariate Abundance
Data with Generalized Linear Latent Variable Models in
<span>R</span>.”</span> <em>Methods in Ecology and Evolution</em> 10
(12): 2173–82. <a href="https://doi.org/10.1111/2041-210X.13303">https://doi.org/10.1111/2041-210X.13303</a>.
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Why do we do this? Consider the slightly simplified case
of a <em>homogeneous</em> Toeplitz structure where all of the variance
parameters are identical. The diagonal elements of the covariance matrix
are equal to <span class="math inline">\(\sigma_t^2\)</span>, the
off-diagonals to <span class="math inline">\(\sigma_t^2 \cdot
\rho(|i-j|)\)</span>. If we add a residual variance to the model then
the diagonal of the combined covariance matrix becomes <span class="math inline">\(\sigma_t^2 + \sigma_r^2\)</span> and the
off-diagonals become <span class="math inline">\((\sigma_t^2 +
\sigma_r^2) \rho(|i-j|)\)</span>. However, by reparameterizing the
Toeplitz model to <span class="math inline">\(\{{\sigma_t^2}&#39; =
\sigma_t^2 + \sigma_r^2, \rho&#39;(|i-j|) = \rho(|i-j|) \cdot
\frac{\sigma_t^2}{\sigma_t^2 + \sigma_r^2}\}\)</span> — that is, by
inflating the variance and deflating the correlation parameters — we can
get back to an equivalent Toeplitz model. This implies that the residual
variance and the Toeplitz covariance parameters are jointly
unidentifiable, which is likely to make problems for the fitting
procedure.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>chocolate, strawberry, vanilla<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
