<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Kasper Kristensen and Maeve McGillycuddy" />

<meta name="date" content="2022-05-31" />

<title>Covariance structures with glmmTMB</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Covariance structures with glmmTMB</h1>
<h4 class="author">Kasper Kristensen and Maeve McGillycuddy</h4>
<h4 class="date">2022-05-31</h4>



<p>This vignette demonstrates some of the covariance structures available in the <code>glmmTMB</code> package. Currently the available covariance structures are:</p>
<table>
<thead>
<tr class="header">
<th>Covariance</th>
<th>Notation</th>
<th>Parameter count</th>
<th>Requirement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Heterogeneous unstructured</td>
<td><code>us</code></td>
<td><span class="math inline">\(n(n+1)/2\)</span></td>
<td></td>
</tr>
<tr class="even">
<td>Heterogeneous Toeplitz</td>
<td><code>toep</code></td>
<td><span class="math inline">\(2n-1\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td>Heterogeneous compound symmetry</td>
<td><code>cs</code></td>
<td><span class="math inline">\(n+1\)</span></td>
<td></td>
</tr>
<tr class="even">
<td>Heterogeneous diagonal</td>
<td><code>diag</code></td>
<td><span class="math inline">\(n\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td>AR(1)</td>
<td><code>ar1</code></td>
<td><span class="math inline">\(2\)</span></td>
<td>Unit spaced levels</td>
</tr>
<tr class="even">
<td>Ornstein-Uhlenbeck</td>
<td><code>ou</code></td>
<td><span class="math inline">\(2\)</span></td>
<td>Coordinates</td>
</tr>
<tr class="odd">
<td>Spatial exponential</td>
<td><code>exp</code></td>
<td><span class="math inline">\(2\)</span></td>
<td>Coordinates</td>
</tr>
<tr class="even">
<td>Spatial Gaussian</td>
<td><code>gau</code></td>
<td><span class="math inline">\(2\)</span></td>
<td>Coordinates</td>
</tr>
<tr class="odd">
<td>Spatial Matern</td>
<td><code>mat</code></td>
<td><span class="math inline">\(3\)</span></td>
<td>Coordinates</td>
</tr>
<tr class="even">
<td>Reduced rank</td>
<td><code>rr</code></td>
<td><span class="math inline">\(nd-d(d-1)/2\)</span></td>
<td>rank (d)</td>
</tr>
</tbody>
</table>
<p>The word ‘heterogeneous’ refers to the marginal variances of the model. Beyond correlation parameters, a heterogeneous structure uses <span class="math inline">\(n\)</span> additional variance parameters where <span class="math inline">\(n\)</span> is the dimension.</p>
<p>Some of the structures require temporal or spatial coordinates. We will show examples of this in a later section.</p>
<div id="the-ar1-covariance-structure" class="section level2">
<h2>The AR(1) covariance structure</h2>
<div id="demonstration-on-simulated-data" class="section level3">
<h3>Demonstration on simulated data</h3>
<p>First, let’s consider a simple time series model. Assume that our measurements <span class="math inline">\(Y(t)\)</span> are given at discrete times <span class="math inline">\(t \in \{1,...,n\}\)</span> by</p>
<p><span class="math display">\[Y(t) = \mu + X(t) + \varepsilon(t)\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\mu\)</span> is the mean value parameter.</li>
<li><span class="math inline">\(X(t)\)</span> is a stationary AR(1) process, i.e. has covariance <span class="math inline">\(cov(X(s), X(t)) = \sigma^2\exp(-\theta |t-s|)\)</span>.</li>
<li><span class="math inline">\(\varepsilon(t)\)</span> is iid. <span class="math inline">\(N(0,\sigma_0^2)\)</span> measurement error.</li>
</ul>
<p>A simulation experiment is set up using the parameters</p>
<table>
<thead>
<tr class="header">
<th>Description</th>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean</td>
<td><span class="math inline">\(\mu\)</span></td>
<td>0</td>
</tr>
<tr class="even">
<td>Process variance</td>
<td><span class="math inline">\(\sigma^2\)</span></td>
<td>1</td>
</tr>
<tr class="odd">
<td>Measurement variance</td>
<td><span class="math inline">\(\sigma_0^2\)</span></td>
<td>1</td>
</tr>
<tr class="even">
<td>One-step correlation</td>
<td><span class="math inline">\(e^{-\theta}\)</span></td>
<td>0.7</td>
</tr>
</tbody>
</table>
<p>The following R-code draws a simulation based on these parameter values. For illustration purposes we consider a very short time series.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>n &lt;-<span class="st"> </span><span class="dv">6</span>                                              <span class="co">## Number of time points</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>x &lt;-<span class="st"> </span><span class="kw">mvrnorm</span>(<span class="dt">mu =</span> <span class="kw">rep</span>(<span class="dv">0</span>,n),</span>
<span id="cb1-3"><a href="#cb1-3"></a>             <span class="dt">Sigma =</span> <span class="fl">.7</span> <span class="op">^</span><span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">dist</span>(<span class="dv">1</span><span class="op">:</span>n)) )    <span class="co">## Simulate the process using the MASS package</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>y &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)                                   <span class="co">## Add measurement noise</span></span></code></pre></div>
<p>In order to fit the model with <code>glmmTMB</code> we must first specify a time variable as a <em>factor</em>. The factor <em>levels</em> correspond to unit spaced time points. It is a common mistake to forget some factor levels due to missing data or to order the levels incorrectly. We therefore recommend to construct factors with explicit levels, using the <code>levels</code> argument to the <code>factor</code> function:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>times &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dt">levels=</span><span class="dv">1</span><span class="op">:</span>n)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">levels</span>(times)</span></code></pre></div>
<pre><code>## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;6&quot;</code></pre>
<p>We also need a grouping variable. In the current case there is only one time-series so the grouping is:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span>,n))</span></code></pre></div>
<p>We combine the data into a single data frame (not absolutely required, but good practice):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>dat0 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(y,times,group)</span></code></pre></div>
<p>Now fit the model using</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">glmmTMB</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">ar1</span>(times <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>group), <span class="dt">data=</span>dat0)</span></code></pre></div>
<p>This formula notation follows that of the <code>lme4</code> package.</p>
<ul>
<li>The left hand side of the bar <code>times + 0</code> corresponds to a design matrix <span class="math inline">\(Z\)</span> linking observation vector <span class="math inline">\(y\)</span> (rows) with a random effects vector <span class="math inline">\(u\)</span> (columns).</li>
<li>The distribution of <span class="math inline">\(u\)</span> is <code>ar1</code> (this is the only <code>glmmTMB</code> specific part of the formula).</li>
<li>The right hand side of the bar splits the above specification independently among groups. Each group has its own separate <span class="math inline">\(u\)</span> vector but shares the same parameters for the covariance structure.</li>
</ul>
<p>After running the model, we find the parameter estimates <span class="math inline">\(\mu\)</span> (intercept), <span class="math inline">\(\sigma_0^2\)</span> (dispersion), <span class="math inline">\(\sigma\)</span> (Std. Dev.) and <span class="math inline">\(e^{-\theta}\)</span> (First off-diagonal of “Corr”) in the output:</p>
<blockquote>
<p>FIXME: Try a longer time series when the print.VarCorr is fixed.</p>
</blockquote>
<pre><code>## Formula:          y ~ ar1(times + 0 | group)
## Data: dat0
##      AIC      BIC   logLik df.resid 
## 18.76343 17.93047 -5.38171        2 
## Random-effects (co)variances:
## 
## Conditional model:
##  Groups   Name   Std.Dev.  Corr       
##  group    times1 7.018e-01 -0.58 (ar1)
##  Residual        1.165e-05            
## 
## Number of obs: 6 / Conditional model: group, 1
## 
## Dispersion estimate for gaussian family (sigma^2): 1.36e-10 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##       1.072</code></pre>
</div>
<div id="increasing-the-sample-size" class="section level3">
<h3>Increasing the sample size</h3>
<p>A single time series of 6 time points is not sufficient to identify the parameters. We could either increase the length of the time series or increase the number of groups. We’ll try the latter:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>simGroup &lt;-<span class="st"> </span><span class="cf">function</span>(g, <span class="dt">n=</span><span class="dv">6</span>, <span class="dt">rho=</span><span class="fl">0.7</span>) {</span>
<span id="cb8-2"><a href="#cb8-2"></a>    x &lt;-<span class="st"> </span><span class="kw">mvrnorm</span>(<span class="dt">mu =</span> <span class="kw">rep</span>(<span class="dv">0</span>,n),</span>
<span id="cb8-3"><a href="#cb8-3"></a>             <span class="dt">Sigma =</span> rho <span class="op">^</span><span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">dist</span>(<span class="dv">1</span><span class="op">:</span>n)) )   <span class="co">## Simulate the process</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>    y &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)                               <span class="co">## Add measurement noise</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>    times &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="dv">1</span><span class="op">:</span>n)</span>
<span id="cb8-6"><a href="#cb8-6"></a>    group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(g,n))</span>
<span id="cb8-7"><a href="#cb8-7"></a>    <span class="kw">data.frame</span>(y, times, group)</span>
<span id="cb8-8"><a href="#cb8-8"></a>}</span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="kw">simGroup</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##           y times group
## 1 0.3008231     1     1
## 2 0.1835385     2     1
## 3 0.3750261     3     1
## 4 1.5819573     4     1
## 5 1.5776466     5     1
## 6 0.2072020     6     1</code></pre>
<p>Generate a dataset with 1000 groups:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>dat1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(<span class="st">&quot;rbind&quot;</span>, <span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, simGroup) )</span></code></pre></div>
<p>And fitting the model on this larger dataset gives estimates close to the true values (AR standard deviation=1, residual (measurement) standard deviation=1, autocorrelation=0.7):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>(fit.ar1 &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">ar1</span>(times <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>group), <span class="dt">data=</span>dat1))</span></code></pre></div>
<pre><code>## Formula:          y ~ ar1(times + 0 | group)
## Data: dat1
##       AIC       BIC    logLik  df.resid 
##  20549.90  20576.70 -10270.95      5996 
## Random-effects (co)variances:
## 
## Conditional model:
##  Groups   Name   Std.Dev. Corr      
##  group    times1 1.003    0.72 (ar1)
##  Residual        1.019              
## 
## Number of obs: 6000 / Conditional model: group, 1000
## 
## Dispersion estimate for gaussian family (sigma^2): 1.04 
## 
## Fixed Effects:
## 
## Conditional model:
## (Intercept)  
##     0.04378</code></pre>
</div>
</div>
<div id="the-unstructured-covariance" class="section level2">
<h2>The unstructured covariance</h2>
<p>We can try to fit an unstructured covariance to the previous dataset <code>dat</code>. For this case an unstructured covariance has 15 correlation parameters and 6 variance parameters. Adding <span class="math inline">\(\sigma_0^2 I\)</span> on top would cause a strict overparameterization, as these would be redundant with the diagonal elements in the covariance matrix. Hence, when fitting the model with <code>glmmTMB</code>, we have to disable the <span class="math inline">\(\varepsilon\)</span> term (the dispersion) by setting <code>dispformula=~0</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>fit.us &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">us</span>(times <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>group), <span class="dt">data=</span>dat1, <span class="dt">dispformula=</span><span class="op">~</span><span class="dv">0</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a>fit.us<span class="op">$</span>sdr<span class="op">$</span>pdHess <span class="co">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The estimated variance and correlation parameters are:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw">VarCorr</span>(fit.us)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name   Std.Dev. Corr                          
##  group  times1 1.4131                                 
##         times2 1.3898   0.353                         
##         times3 1.5018   0.273 0.384                   
##         times4 1.4040   0.166 0.216 0.352             
##         times5 1.4331   0.160 0.192 0.239 0.354       
##         times6 1.4375   0.108 0.136 0.195 0.273 0.345</code></pre>

<p>The estimated correlation is approximately constant along diagonals (apparent Toeplitz structure) and we note that the first off-diagonal is now ca. half the true value (0.7) because the dispersion is effectively included in the estimated covariance matrix (i.e. <span class="math inline">\(\rho&#39; = \rho \sigma^2_{{\text {AR}}}/(\sigma^2_{{\text {AR}}} + \sigma^2_{{\text {meas}}})\)</span>).</p>
</div>
<div id="the-toeplitz-structure" class="section level2">
<h2>The Toeplitz structure</h2>
<p>The next natural step would be to reduce the number of parameters by collecting correlation parameters within the same off-diagonal. This amounts to 5 correlation parameters and 6 variance parameters.</p>
<blockquote>
<p>FIXME: Explain why dispformula=~1 causes over-parameterization</p>
</blockquote>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>fit.toep &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">toep</span>(times <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>group), <span class="dt">data=</span>dat1, <span class="dt">dispformula=</span><span class="op">~</span><span class="dv">0</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a>fit.toep<span class="op">$</span>sdr<span class="op">$</span>pdHess <span class="co">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The estimated variance and correlation parameters are:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>(vc.toep &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(fit.toep))</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name   Std.Dev. Corr                          
##  group  times1 1.4126                                 
##         times2 1.3878   0.358                         
##         times3 1.4961   0.249 0.358                   
##         times4 1.4070   0.188 0.249 0.358             
##         times5 1.4369   0.148 0.188 0.249 0.358       
##         times6 1.4388   0.106 0.148 0.188 0.249 0.358</code></pre>
<p>The diagonal elements are all approximately equal to the true total variance (<span class="math inline">\(\sigma^2_{{\text {AR}}} + \sigma^2_{{\text {meas}}}\)</span>=2), and the off-diagonal elements are approximately equal to the expected value of 0.7/2=0.35.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>vc1 &lt;-<span class="st"> </span>vc.toep<span class="op">$</span>cond[[<span class="dv">1</span>]] <span class="co">## first term of var-cov for RE of conditional model</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="kw">summary</span>(<span class="kw">diag</span>(vc1))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.926   1.984   2.030   2.046   2.069   2.238</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">summary</span>(vc1[<span class="kw">row</span>(vc1)<span class="op">!=</span><span class="kw">col</span>(vc1)])</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.2159  0.3745  0.5045  0.5119  0.7178  0.7530</code></pre>
<p>We can get a <em>slightly</em> better estimate of the variance by using REML estimation (however, the estimate of the correlations seems to have gotten slightly worse):</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>fit.toep.reml &lt;-<span class="st"> </span><span class="kw">update</span>(fit.toep, <span class="dt">REML=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning in fitTMB(TMBStruc): Model convergence problem; false convergence (8).
## See vignette(&#39;troubleshooting&#39;)</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>vc1R &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(fit.toep.reml)<span class="op">$</span>cond[[<span class="dv">1</span>]]</span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="kw">summary</span>(<span class="kw">diag</span>(vc1R))</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.927   1.984   2.031   2.046   2.069   2.239</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">summary</span>(vc1R[<span class="kw">row</span>(vc1R)<span class="op">!=</span><span class="kw">col</span>(vc1R)])</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.2167  0.3752  0.5053  0.5127  0.7185  0.7538</code></pre>
</div>
<div id="compound-symmetry" class="section level2">
<h2>Compound symmetry</h2>
<p>The compound symmetry structure collects all off-diagonal elements of the correlation matrix to one common value.</p>
<blockquote>
<p>FIXME: Explain why dispformula=~1 causes over-parameterization</p>
</blockquote>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>fit.cs &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">cs</span>(times <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>group), <span class="dt">data=</span>dat1, <span class="dt">dispformula=</span><span class="op">~</span><span class="dv">0</span>)</span>
<span id="cb31-2"><a href="#cb31-2"></a>fit.cs<span class="op">$</span>sdr<span class="op">$</span>pdHess <span class="co">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The estimated variance and correlation parameters are:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">VarCorr</span>(fit.cs)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name   Std.Dev. Corr      
##  group  times1 1.4312   0.250 (cs)</code></pre>
</div>
<div id="anova-tables" class="section level2">
<h2>Anova tables</h2>
<p>The models <code>ar1</code>, <code>toep</code>, and <code>us</code> are nested so we can use:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">anova</span>(fit.ar1, fit.toep, fit.us)</span></code></pre></div>
<pre><code>## Data: dat1
## Models:
## fit.ar1: y ~ ar1(times + 0 | group), zi=~0, disp=~1
## fit.toep: y ~ toep(times + 0 | group), zi=~0, disp=~0
## fit.us: y ~ us(times + 0 | group), zi=~0, disp=~0
##          Df   AIC   BIC logLik deviance  Chisq Chi Df Pr(&gt;Chisq)
## fit.ar1   4 20550 20577 -10271    20542                         
## fit.toep 12 20556 20637 -10266    20532 9.4895      8     0.3027
## fit.us   22 20570 20717 -10263    20526 6.5103     10     0.7707</code></pre>
<p><code>ar1</code> has the lowest AIC (it’s the simplest model, and fits the data adequately); we can’t reject the (true in this case!) null model that an AR1 structure is adequate to describe the data.</p>
<p>The model <code>cs</code> is a sub-model of <code>toep</code>:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">anova</span>(fit.cs, fit.toep)</span></code></pre></div>
<pre><code>## Data: dat1
## Models:
## fit.cs: y ~ cs(times + 0 | group), zi=~0, disp=~0
## fit.toep: y ~ toep(times + 0 | group), zi=~0, disp=~0
##          Df   AIC   BIC logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    
## fit.cs    8 20703 20756 -10343    20687                             
## fit.toep 12 20556 20637 -10266    20532 154.48      4  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Here we <em>can</em> reject the null hypothesis of compound symmetry (i.e., that all the pairwise correlations are the same).</p>
</div>
<div id="adding-coordinate-information" class="section level2">
<h2>Adding coordinate information</h2>
<p>Coordinate information can be added to a variable using the <code>glmmTMB</code> function <code>numFactor</code>. This is necessary in order to use those covariance structures that require coordinates. For example, if we have the numeric coordinates</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">10</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>)</span>
<span id="cb39-2"><a href="#cb39-2"></a>y &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">10</span>, <span class="dt">replace=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p>we can generate a factor representing <span class="math inline">\((x,y)\)</span> coordinates by</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>(pos &lt;-<span class="st"> </span><span class="kw">numFactor</span>(x,y))</span></code></pre></div>
<pre><code>##  [1] (2,1) (2,1) (1,1) (2,2) (2,2) (1,2) (2,1) (2,2) (1,1) (2,2)
## Levels: (1,1) (2,1) (1,2) (2,2)</code></pre>
<p>Numeric coordinates can be recovered from the factor levels:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="kw">parseNumLevels</span>(<span class="kw">levels</span>(pos))</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    1
## [2,]    2    1
## [3,]    1    2
## [4,]    2    2</code></pre>
<p>In order to try the remaining structures on our test data we re-interpret the time factor using <code>numFactor</code>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>dat1<span class="op">$</span>times &lt;-<span class="st"> </span><span class="kw">numFactor</span>(dat1<span class="op">$</span>times)</span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="kw">levels</span>(dat1<span class="op">$</span>times)</span></code></pre></div>
<pre><code>## [1] &quot;(1)&quot; &quot;(2)&quot; &quot;(3)&quot; &quot;(4)&quot; &quot;(5)&quot; &quot;(6)&quot;</code></pre>
</div>
<div id="ornsteinuhlenbeck" class="section level2">
<h2>Ornstein–Uhlenbeck</h2>
<p>Having the numeric times encoded in the factor levels we can now try the Ornstein–Uhlenbeck covariance structure.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>fit.ou &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">ou</span>(times <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>group), <span class="dt">data=</span>dat1)</span>
<span id="cb46-2"><a href="#cb46-2"></a>fit.ou<span class="op">$</span>sdr<span class="op">$</span>pdHess <span class="co">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>It should give the exact same results as <code>ar1</code> in this case since the times are equidistant:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="kw">VarCorr</span>(fit.ou)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups   Name     Std.Dev. Corr                          
##  group    times(1) 1.0034                                 
##           times(2) 1.0034   0.721                         
##           times(3) 1.0034   0.520 0.721                   
##           times(4) 1.0034   0.375 0.520 0.721             
##           times(5) 1.0034   0.270 0.375 0.520 0.721       
##           times(6) 1.0034   0.195 0.270 0.375 0.520 0.721 
##  Residual          1.0187</code></pre>
<p>However, note the differences between <code>ou</code> and <code>ar1</code>:</p>
<ul>
<li><code>ou</code> can handle irregular time points.</li>
<li><code>ou</code> only allows positive correlation between neighboring time points.</li>
</ul>
</div>
<div id="spatial-correlations" class="section level2">
<h2>Spatial correlations</h2>
<p>The structures <code>exp</code>, <code>gau</code> and <code>mat</code> are meant to used for spatial data. They all require a Euclidean distance matrix which is calculated internally based on the coordinates. Here, we will try these models on the simulated time series data.</p>
<p>An example with spatial data is presented in a later section.</p>
<div id="matern" class="section level3">
<h3>Matern</h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>fit.mat &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">mat</span>(times <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>group), <span class="dt">data=</span>dat1, <span class="dt">dispformula=</span><span class="op">~</span><span class="dv">0</span>)</span>
<span id="cb50-2"><a href="#cb50-2"></a>fit.mat<span class="op">$</span>sdr<span class="op">$</span>pdHess <span class="co">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="kw">VarCorr</span>(fit.mat)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name     Std.Dev. Corr                          
##  group  times(1) 1.43                                   
##         times(2) 1.43     0.357                         
##         times(3) 1.43     0.250 0.357                   
##         times(4) 1.43     0.187 0.250 0.357             
##         times(5) 1.43     0.143 0.187 0.250 0.357       
##         times(6) 1.43     0.111 0.143 0.187 0.250 0.357</code></pre>
</div>
<div id="gaussian" class="section level3">
<h3>Gaussian</h3>
<p>“Gaussian” refers here to a Gaussian decay in correlation with distance, i.e. <span class="math inline">\(\rho = \exp(-d x^2)\)</span>, not to the conditional distribution (“family”).</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>fit.gau &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">gau</span>(times <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>group), <span class="dt">data=</span>dat1, <span class="dt">dispformula=</span><span class="op">~</span><span class="dv">0</span>)</span>
<span id="cb54-2"><a href="#cb54-2"></a>fit.gau<span class="op">$</span>sdr<span class="op">$</span>pdHess <span class="co">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="kw">VarCorr</span>(fit.gau)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups Name     Std.Dev. Corr                          
##  group  times(1) 1.4175                                 
##         times(2) 1.4175   0.280                         
##         times(3) 1.4175   0.006 0.280                   
##         times(4) 1.4175   0.000 0.006 0.280             
##         times(5) 1.4175   0.000 0.000 0.006 0.280       
##         times(6) 1.4175   0.000 0.000 0.000 0.006 0.280</code></pre>
</div>
<div id="exponential" class="section level3">
<h3>Exponential</h3>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>fit.exp &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">exp</span>(times <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>group), <span class="dt">data=</span>dat1)</span>
<span id="cb58-2"><a href="#cb58-2"></a>fit.exp<span class="op">$</span>sdr<span class="op">$</span>pdHess <span class="co">## Converged ?</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="kw">VarCorr</span>(fit.exp)</span></code></pre></div>
<pre><code>## 
## Conditional model:
##  Groups   Name     Std.Dev. Corr                          
##  group    times(1) 1.0034                                 
##           times(2) 1.0034   0.721                         
##           times(3) 1.0034   0.520 0.721                   
##           times(4) 1.0034   0.375 0.520 0.721             
##           times(5) 1.0034   0.270 0.375 0.520 0.721       
##           times(6) 1.0034   0.195 0.270 0.375 0.520 0.721 
##  Residual          1.0187</code></pre>
</div>
<div id="a-spatial-covariance-example" class="section level3">
<h3>A spatial covariance example</h3>
<p>Starting out with the built in <code>volcano</code> dataset we reshape it to a <code>data.frame</code> with pixel intensity <code>z</code> and pixel position <code>x</code> and <code>y</code>:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">z =</span> <span class="kw">as.vector</span>(volcano),</span>
<span id="cb62-2"><a href="#cb62-2"></a>                <span class="dt">x =</span> <span class="kw">as.vector</span>(<span class="kw">row</span>(volcano)),</span>
<span id="cb62-3"><a href="#cb62-3"></a>                <span class="dt">y =</span> <span class="kw">as.vector</span>(<span class="kw">col</span>(volcano)))</span></code></pre></div>
<p>Next, add random normal noise to the pixel intensities and extract a small subset of 100 pixels. This is our spatial dataset:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb63-2"><a href="#cb63-2"></a>d<span class="op">$</span>z &lt;-<span class="st"> </span>d<span class="op">$</span>z <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(volcano), <span class="dt">sd=</span><span class="dv">15</span>)</span>
<span id="cb63-3"><a href="#cb63-3"></a>d &lt;-<span class="st"> </span>d[<span class="kw">sample</span>(<span class="kw">nrow</span>(d), <span class="dv">100</span>), ]</span></code></pre></div>
<p>Display sampled noisy volcano data:</p>
<!-- never evaluate -->
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>volcano.data &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="ot">NA</span>, <span class="kw">dim</span>(volcano))</span>
<span id="cb64-2"><a href="#cb64-2"></a>volcano.data[<span class="kw">cbind</span>(d<span class="op">$</span>x, d<span class="op">$</span>y)] &lt;-<span class="st"> </span>d<span class="op">$</span>z</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="kw">image</span>(volcano.data, <span class="dt">main=</span><span class="st">&quot;Spatial data&quot;</span>, <span class="dt">useRaster=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<!-- evaluate if NOT_CRAN -->
<!-- always evaluate -->
<p><img src="data:image/png;base64,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" width="480" /></p>
<p>Based on this data, we’ll attempt to re-construct the original image.</p>
<p>As model, it is assumed that the original image <code>image(volcano)</code> is a realization of a random field with correlation decaying exponentially with distance between pixels.</p>
<p>Denoting by <span class="math inline">\(u(x,y)\)</span> this random field the model for the observations is</p>
<p><span class="math display">\[ z_{i} = \mu + u(x_i,y_i) + \varepsilon_i \]</span></p>
<p>To fit the model, a <code>numFactor</code> and a dummy grouping variable must be added to the dataset:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>d<span class="op">$</span>pos &lt;-<span class="st"> </span><span class="kw">numFactor</span>(d<span class="op">$</span>x, d<span class="op">$</span>y)</span>
<span id="cb65-2"><a href="#cb65-2"></a>d<span class="op">$</span>group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(d)))</span></code></pre></div>
<p>The model is fit by</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>f &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(z <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(pos <span class="op">+</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>group), <span class="dt">data=</span>d)</span></code></pre></div>
<p>Recall that a standard deviation <code>sd=15</code> was used to distort the image. A confidence interval for this parameter is</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="kw">confint</span>(f, <span class="st">&quot;sigma&quot;</span>)</span></code></pre></div>
<pre><code>##          2.5 %   97.5 % Estimate
## sigma 10.61016 18.06028 13.84278</code></pre>
<p>The glmmTMB <code>predict</code> method can predict unseen levels of the random effects. For instance to predict a 3-by-3 corner of the image one could construct the new data:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>newdata &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">pos=</span><span class="kw">numFactor</span>(<span class="kw">expand.grid</span>(<span class="dt">x=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,<span class="dt">y=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)) )</span>
<span id="cb69-2"><a href="#cb69-2"></a>newdata<span class="op">$</span>group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(newdata)))</span>
<span id="cb69-3"><a href="#cb69-3"></a>newdata</span></code></pre></div>
<pre><code>##     pos group
## 1 (1,1)     1
## 2 (2,1)     1
## 3 (3,1)     1
## 4 (1,2)     1
## 5 (2,2)     1
## 6 (3,2)     1
## 7 (1,3)     1
## 8 (2,3)     1
## 9 (3,3)     1</code></pre>
<p>and predict using</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="kw">predict</span>(f, newdata, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>, <span class="dt">allow.new.levels=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 114.3405 115.2834 116.2061 114.6033 115.6916 116.7725 114.7828 116.0382
## [9] 117.3101</code></pre>
<p>A specific image column can thus be predicted using the function</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a>predict_col &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</span>
<span id="cb73-2"><a href="#cb73-2"></a>    newdata &lt;-<span class="st"> </span><span class="kw">data.frame</span>( <span class="dt">pos =</span> <span class="kw">numFactor</span>(<span class="kw">expand.grid</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">87</span>,i)))</span>
<span id="cb73-3"><a href="#cb73-3"></a>    newdata<span class="op">$</span>group &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span>,<span class="kw">nrow</span>(newdata)))</span>
<span id="cb73-4"><a href="#cb73-4"></a>    <span class="kw">predict</span>(f, <span class="dt">newdata=</span>newdata, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>, <span class="dt">allow.new.levels=</span><span class="ot">TRUE</span>)</span>
<span id="cb73-5"><a href="#cb73-5"></a>}</span></code></pre></div>
<p>Prediction of the entire image is carried out by (this takes a while…):</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>pred &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">61</span>, predict_col)</span></code></pre></div>
<p>Finally plot the re-constructed image by</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="kw">image</span>(pred, <span class="dt">main=</span><span class="st">&quot;Reconstruction&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAHgCAIAAADytinCAAAgAElEQVR4nO3de3BV1fn/8XVyDiExCcmBhIsQJUFAgyKIBgj4DSpX/QphkCJCbb3QOqQ6olWZsWWqHanTTsVeNDptmUalzlSxBrwQi3IRuQi/QUDSFKuYgARjYhITjCEJ+/fHmS9uNmZ3s8++PDt5v/5KTpK91skJH5dnPevZIU3TFABAngS/JwAA+G4ENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENAAIRUADgFAENFw0fPjwkE5CQkJ2dvYTTzzh97yUUqqxsbG+vr6jo8Ola544cSIUCiUnJzt4ffQ0BDRcl5OTM2bMmMsvv3zQoEFHjx69//77t2zZ4vek1DXXXJOZmblv3z6XrpmQkDBmzJjRo0c7eH30NAQ0XLdq1aq9e/d+8MEHR44cufjii5VSb7/9tt+Tcl1ycvLevXt37drl90QQYAQ0vJOQkDBp0iSlVOx//D/99NOioqKsrKwBAwb88Ic/bGpqin1bY2PjkiVLhg4dmpGRMW3atL1798Yeb21tffDBB0eOHJmWlnbVVVf97W9/iz3++eefh0KhrKysV1999dJLL+3Tp8/s2bNra2tjX92+fXthYWGfPn369+8/Z86cgwcPKqXGjh37wQcfKKWuvPLKtWvXnr7Cjh07Yo8cPHgwFApdcsklsYu89957oVBo4sSJJjM0XNPwFoe9yaOn0wDXXHTRRUqpV199Nfbp559/HltBv/fee1999dXAgQN79eo1d+7cyZMnK6VmzZrV2dl56tSpCRMmKKVGjx49efLkUCiUmZn5+eefa5o2c+ZMpVR2dvYNN9xw3nnnKaVKSko0TTt+/LhSKhKJ9O7de8yYMZFIRCl15513apr2xRdf9OnTJyEhYe7cuddcc41S6vzzz29tbd2wYcOFF16olHrssceOHDkSu0Jqamp2drZS6uWXX/7www+VUhdffHFs5tu2bVNKTZgwQdO0rmZouGZLS4tSKikpKXYFG5MHCGi4KBbQepFI5K9//aumabGtwrvvvjv2nQUFBUqp9evXb9y4USk1fPjwjo4OTdNuueWWSCTyl7/85d13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" width="480" /></p>
</div>
</div>
<div id="mappings" class="section level2">
<h2>Mappings</h2>
<p>For various advanced purposes, such as computing likelihood profiles, it is useful to know the details of the parameterization of the models - the scale on which the parameters are defined (e.g. standard deviation, variance, or log-standard deviation for variance parameters) and their order.</p>
<div id="unstructured" class="section level3">
<h3>Unstructured</h3>
<p>For an unstructured matrix of size <code>n</code>, parameters <code>1:n</code> represent the log-standard deviations while the remaining <code>n(n-1)/2</code> (i.e. <code>(n+1):(n:(n*(n+1)/2))</code>) are the elements of the <em>scaled</em> Cholesky factor of the correlation matrix, filled in row-wise order (see <a href="http://kaskr.github.io/adcomp/classUNSTRUCTURED__CORR__t.html">TMB documentation</a>). In particular, if <span class="math inline">\(L\)</span> is the lower-triangular matrix with 1 on the diagonal and the correlation parameters in the lower triangle, then the correlation matrix is defined as <span class="math inline">\(\Sigma = D^{-1/2} L L^\top D^{-1/2}\)</span>, where <span class="math inline">\(D = \textrm{diag}(L L^\top)\)</span>. For a single correlation parameter <span class="math inline">\(\theta_0\)</span>, this works out to <span class="math inline">\(\rho = \theta_0/\sqrt{1+\theta_0^2}\)</span>.</p>
<p>(See calculations <a href="https://github.com/glmmTMB/glmmTMB/blob/master/misc/glmmTMB_corcalcs.ipynb">here</a>.)</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>vv0 &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(fit.us)</span>
<span id="cb76-2"><a href="#cb76-2"></a>vv1 &lt;-<span class="st"> </span>vv0<span class="op">$</span>cond<span class="op">$</span>group          <span class="co">## extract &#39;naked&#39; V-C matrix</span></span>
<span id="cb76-3"><a href="#cb76-3"></a>n &lt;-<span class="st"> </span><span class="kw">nrow</span>(vv1)</span>
<span id="cb76-4"><a href="#cb76-4"></a>rpars &lt;-<span class="st"> </span><span class="kw">getME</span>(fit.us,<span class="st">&quot;theta&quot;</span>) <span class="co">## extract V-C parameters</span></span>
<span id="cb76-5"><a href="#cb76-5"></a><span class="co">## first n parameters are log-std devs:</span></span>
<span id="cb76-6"><a href="#cb76-6"></a><span class="kw">all.equal</span>(<span class="kw">unname</span>(<span class="kw">diag</span>(vv1)),<span class="kw">exp</span>(rpars[<span class="dv">1</span><span class="op">:</span>n])<span class="op">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="co">## now try correlation parameters:</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>cpars &lt;-<span class="st"> </span>rpars[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span>n)]</span>
<span id="cb78-3"><a href="#cb78-3"></a><span class="kw">length</span>(cpars)<span class="op">==</span>n<span class="op">*</span>(n<span class="dv">-1</span>)<span class="op">/</span><span class="dv">2</span>      <span class="co">## the expected number</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>cc &lt;-<span class="st"> </span><span class="kw">diag</span>(n)</span>
<span id="cb80-2"><a href="#cb80-2"></a>cc[<span class="kw">upper.tri</span>(cc)] &lt;-<span class="st"> </span>cpars</span>
<span id="cb80-3"><a href="#cb80-3"></a>L &lt;-<span class="st"> </span><span class="kw">crossprod</span>(cc)</span>
<span id="cb80-4"><a href="#cb80-4"></a>D &lt;-<span class="st"> </span><span class="kw">diag</span>(<span class="dv">1</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="kw">diag</span>(L)))</span>
<span id="cb80-5"><a href="#cb80-5"></a><span class="kw">round</span>(D <span class="op">%*%</span><span class="st"> </span>L <span class="op">%*%</span><span class="st"> </span>D,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##       [,1]  [,2]  [,3]  [,4]  [,5]  [,6]
## [1,] 1.000 0.353 0.273 0.166 0.160 0.108
## [2,] 0.353 1.000 0.384 0.216 0.192 0.136
## [3,] 0.273 0.384 1.000 0.352 0.239 0.195
## [4,] 0.166 0.216 0.352 1.000 0.354 0.273
## [5,] 0.160 0.192 0.239 0.354 1.000 0.345
## [6,] 0.108 0.136 0.195 0.273 0.345 1.000</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="kw">round</span>(<span class="kw">unname</span>(<span class="kw">attr</span>(vv1,<span class="st">&quot;correlation&quot;</span>)),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##       [,1]  [,2]  [,3]  [,4]  [,5]  [,6]
## [1,] 1.000 0.353 0.273 0.166 0.160 0.108
## [2,] 0.353 1.000 0.384 0.216 0.192 0.136
## [3,] 0.273 0.384 1.000 0.352 0.239 0.195
## [4,] 0.166 0.216 0.352 1.000 0.354 0.273
## [5,] 0.160 0.192 0.239 0.354 1.000 0.345
## [6,] 0.108 0.136 0.195 0.273 0.345 1.000</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="kw">all.equal</span>(<span class="kw">c</span>(<span class="kw">cov2cor</span>(vv1)),<span class="kw">c</span>(fit.us<span class="op">$</span>obj<span class="op">$</span>env<span class="op">$</span><span class="kw">report</span>(fit.us<span class="op">$</span>fit<span class="op">$</span>parfull)<span class="op">$</span>corr[[<span class="dv">1</span>]]))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Profiling (experimental/exploratory):</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="co">## want $par, not $parfull: do NOT include conditional modes/&#39;b&#39; parameters</span></span>
<span id="cb86-2"><a href="#cb86-2"></a>ppar &lt;-<span class="st"> </span>fit.us<span class="op">$</span>fit<span class="op">$</span>par</span>
<span id="cb86-3"><a href="#cb86-3"></a><span class="kw">length</span>(ppar)</span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="kw">range</span>(<span class="kw">which</span>(<span class="kw">names</span>(ppar)<span class="op">==</span><span class="st">&quot;theta&quot;</span>)) <span class="co">## the last n*(n+1)/2 parameters</span></span></code></pre></div>
<pre><code>## [1]  2 22</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="co">## only 1 fixed effect parameter</span></span>
<span id="cb90-2"><a href="#cb90-2"></a>tt &lt;-<span class="st"> </span><span class="kw">tmbprofile</span>(fit.us<span class="op">$</span>obj,<span class="dv">2</span>,<span class="dt">trace=</span><span class="ot">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a><span class="kw">confint</span>(tt)</span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="kw">plot</span>(tt)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="480" /></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>ppar &lt;-<span class="st"> </span>fit.cs<span class="op">$</span>fit<span class="op">$</span>par</span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="kw">length</span>(ppar)</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="kw">range</span>(<span class="kw">which</span>(<span class="kw">names</span>(ppar)<span class="op">==</span><span class="st">&quot;theta&quot;</span>)) <span class="co">## the last n*(n+1)/2 parameters</span></span></code></pre></div>
<pre><code>## [1] 2 8</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="co">## only 1 fixed effect parameter, 1 dispersion parameter</span></span>
<span id="cb96-2"><a href="#cb96-2"></a>tt2 &lt;-<span class="st"> </span><span class="kw">tmbprofile</span>(fit.cs<span class="op">$</span>obj,<span class="dv">3</span>,<span class="dt">trace=</span><span class="ot">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="kw">plot</span>(tt2)</span></code></pre></div>
<p><img src="data:image/png;base64,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" width="480" /></p>
</div>
</div>
<div id="general-latent-variable-model" class="section level2">
<h2>General latent variable model</h2>
<p>Consider a generalized linear mixed model</p>
<p><span class="math display">\[\begin{equation}
g(\boldsymbol{\mu}) = \boldsymbol{X\beta} + \boldsymbol{Zb}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(g(.)\)</span> is the link function; <span class="math inline">\(\boldsymbol{\beta}\)</span> is a p-dimensional vector of regression coefficients related to the covariates; <span class="math inline">\(\boldsymbol{X}\)</span> is an <span class="math inline">\(n \times p\)</span> model matrix; and <span class="math inline">\(\boldsymbol{Z}\)</span> is the <span class="math inline">\(n\times q\)</span> model matrix for the <span class="math inline">\(q\)</span>-dimensional vector-valued random effects variable <span class="math inline">\(\boldsymbol{U}\)</span> which is multivariate normal with mean zero and a parameterized <span class="math inline">\(q \times q\)</span> variance-covariance matrix, <span class="math inline">\(\boldsymbol{\Sigma}\)</span>, i.e., <span class="math inline">\(\boldsymbol{U} \sim N(\boldsymbol{0}, \boldsymbol{\Sigma})\)</span>.</p>
<p>A general latent variable model (GLVM) requires many fewer parameters for the variance-covariance matrix, <span class="math inline">\(\boldsymbol{\Sigma}\)</span>. To a fit a GLVM we add a <em>reduced-rank</em> (rr) covariance structure, so the model becomes <!-- --> <span class="math display">\[\begin{align}
g(\boldsymbol{\mu}) &amp;= \boldsymbol{X\beta} + \boldsymbol{Z(I_n \otimes \Lambda)b} \\
&amp;= \boldsymbol{X\beta} + \boldsymbol{Zb_{new}}
\end{align}\]</span> <!-- --> where <span class="math inline">\(\otimes\)</span> is the Kronecker product and <span class="math inline">\(\boldsymbol{\Lambda} = (\boldsymbol{\lambda_1}, \ldots, \boldsymbol{\lambda_d})&#39;\)</span> is the <span class="math inline">\(q \times d\)</span> matrix of factor loadings (with <span class="math inline">\(d \ll q\)</span>). The upper triangular elements of <span class="math inline">\(\boldsymbol{\Lambda}\)</span> are set to be zero to ensure parameter identifiability. Here we assume that the latent variables follow a multivariate standard normal distribution, <span class="math inline">\(\boldsymbol{b} \sim N(\boldsymbol{0}, \boldsymbol{I})\)</span>.</p>
<p>For GLVMs it is important to select initial starting values for the parameters because the observed likelihood may be multimodal, and maximization algorithms can end up in local maxima. <span class="citation">Niku et al. (2019)</span> describe methods to enable faster and more reliable fits of latent variable models by carefully choosing starting values of the parameters.</p>
<p>A similar method has been implemented in <code>glmmTMB</code>. A generalized linear model is fitted to the data to obtain initial starting values for the fixed parameters in the model. Residuals from the fitted GLM are calculated; Dunn-Smyth residuals are calculated for common families while residuals from the <code>dev.resids()</code> function are used otherwise. Initial starting values for the latent variables and their loadings are obtained by fitting a reduced rank model to the residuals.</p>
<div id="reduced-rank" class="section level3">
<h3>Reduced rank</h3>
<p>One of our main motivations for adding this variance-covariance structure is to enable the analysis of multivariate abundance data, for example to model the abundance of different taxa across multiple sites. Typically an unstructured random effect is assumed to account for correlation between taxa; however the number of parameters required quickly becomes large with increasing numbers of taxa. A GLVM is a flexible and more parsimonious way to account for correlation so that one can fit a joint model across many taxa.</p>
<p>A GLVM can be fit by specifying a reduced rank (<code>rr</code>) covariance structure. For example, the code for modeling the mean abundance against taxa and to account for the correlation between taxa using two latent variables is as follows</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="cf">if</span> (<span class="kw">require</span>(mvabund)) {</span>
<span id="cb98-2"><a href="#cb98-2"></a>    <span class="kw">data</span>(spider)</span>
<span id="cb98-3"><a href="#cb98-3"></a>    <span class="co">## organize data into long format</span></span>
<span id="cb98-4"><a href="#cb98-4"></a>    sppTot &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">colSums</span>(spider<span class="op">$</span>abund), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</span>
<span id="cb98-5"><a href="#cb98-5"></a>    tmp &lt;-<span class="st"> </span><span class="kw">cbind</span>(spider<span class="op">$</span>abund, spider<span class="op">$</span>x)</span>
<span id="cb98-6"><a href="#cb98-6"></a>    tmp<span class="op">$</span>id &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(tmp)</span>
<span id="cb98-7"><a href="#cb98-7"></a>    spiderDat &lt;-<span class="st"> </span><span class="kw">reshape</span>(tmp,</span>
<span id="cb98-8"><a href="#cb98-8"></a>                         <span class="dt">idvar =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb98-9"><a href="#cb98-9"></a>                         <span class="dt">timevar =</span> <span class="st">&quot;Species&quot;</span>,</span>
<span id="cb98-10"><a href="#cb98-10"></a>                         <span class="dt">times =</span>  <span class="kw">colnames</span>(spider<span class="op">$</span>abund),</span>
<span id="cb98-11"><a href="#cb98-11"></a>                         <span class="dt">varying =</span> <span class="kw">list</span>(<span class="kw">colnames</span>(spider<span class="op">$</span>abund)),</span>
<span id="cb98-12"><a href="#cb98-12"></a>                         <span class="dt">v.names =</span> <span class="st">&quot;abund&quot;</span>,</span>
<span id="cb98-13"><a href="#cb98-13"></a>                         <span class="dt">direction =</span> <span class="st">&quot;long&quot;</span>)</span>
<span id="cb98-14"><a href="#cb98-14"></a>    <span class="co">## fit rank-reduced models with varying dimension</span></span>
<span id="cb98-15"><a href="#cb98-15"></a>    fit_list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">10</span>,</span>
<span id="cb98-16"><a href="#cb98-16"></a>                       <span class="cf">function</span>(d) {</span>
<span id="cb98-17"><a href="#cb98-17"></a>                           fit.rr &lt;-<span class="st"> </span><span class="kw">glmmTMB</span>(abund <span class="op">~</span><span class="st"> </span>Species <span class="op">+</span><span class="st"> </span><span class="kw">rr</span>(Species <span class="op">+</span><span class="st"> </span><span class="dv">0</span><span class="op">|</span>id, <span class="dt">d =</span> d),</span>
<span id="cb98-18"><a href="#cb98-18"></a>                                             <span class="dt">data =</span> spiderDat)</span>
<span id="cb98-19"><a href="#cb98-19"></a>                       })</span>
<span id="cb98-20"><a href="#cb98-20"></a>    <span class="co">## compare fits via AIC</span></span>
<span id="cb98-21"><a href="#cb98-21"></a>    aic_vec &lt;-<span class="st"> </span><span class="kw">sapply</span>(fit_list, AIC)</span>
<span id="cb98-22"><a href="#cb98-22"></a>    aic_vec <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(aic_vec, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>The left hand side of the bar <code>taxa + 0</code> corresponds to a factor loading matrix that accounts for the correlations among taxa. The right hand side of the bar splits the above specification independently among sites. The <code>d</code> is a non-negative integer (which defaults to 2).</p>
<p>An option in <code>glmmTMBControl()</code> has been included to initialize the starting values for the parameters based on the approach mentioned above with the default set at <code>glmmTMBControl(start_method = list(method = NULL, jitter.sd = 0)</code>:</p>
<ul>
<li><code>method = &quot;res&quot;</code> initializes starting values from the results of fitting a GLM, and fitting a reduced rank model to the residuals to obtain starting values for the fixed coefficients, the latent variables and the factor loadings.</li>
<li><code>jitter.sd</code> adds variation to the starting values of latent variables when <code>method = &quot;res&quot;</code> (default 0).</li>
</ul>
<p>For a reduced rank matrix of rank <code>d</code>, parameters <code>1:d</code> represent the diagonal factor loadings while the remaining <code>$nd-d(d-3)/2$</code>, (i.e. <code>(d+1):(nd-d(d-1)/2</code>) are the lower diagonal factor loadings filled in column-wise order. The factor loadings from a model can be obtained by <code>fit.rr$obj$env$report(fit.rr$fit$parfull)$fact_load[[1]]</code>. An appropriate rank for the model can be determined by standard model selection approaches such as information criteria (e.g. AIC or BIC) <span class="citation">(Hui et al. 2015)</span>.</p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-hui2015model">
<p>Hui, Francis KC, Sara Taskinen, Shirley Pledger, Scott D Foster, and David I Warton. 2015. “Model-Based Approaches to Unconstrained Ordination.” <em>Methods in Ecology and Evolution</em> 6 (4): 399–411. <a href="https://doi.org/https://doi.org/10.1111/2041-210X.12236">https://doi.org/https://doi.org/10.1111/2041-210X.12236</a>.</p>
</div>
<div id="ref-niku2019gllvm">
<p>Niku, Jenni, Francis K. C. Hui, Sara Taskinen, and David I. Warton. 2019. “Gllvm: Fast Analysis of Multivariate Abundance Data with Generalized Linear Latent Variable Models in R.” <em>Methods in Ecology and Evolution</em> 10 (12): 2173–82. <a href="https://doi.org/https://doi.org/10.1111/2041-210X.13303">https://doi.org/https://doi.org/10.1111/2041-210X.13303</a>.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
